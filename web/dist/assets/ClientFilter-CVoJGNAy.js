import{_ as F,a as J,r as f,o as U,c as o,b as e,e as u,s as p,t as d,f as x,M,F as N,x as T,d as S,p as _,v as C,l as b,E as v,n}from"./index-CQyKkE5B.js";const A={class:"client-filter-page"},$={class:"switch-card"},E={class:"switch-content"},D={class:"switch-info"},L={class:"toggle-switch large"},I=["disabled"],R={key:0,class:"info-banner"},z={class:"section-card"},P={class:"section-header"},Y={class:"section-badge"},j={class:"client-grid"},q=["onClick"],G={class:"client-icon"},H={class:"client-info"},K={class:"client-name"},Q={class:"client-desc"},W={key:0,class:"check-mark"},X={class:"section-card"},Z={class:"mode-selector"},ee={class:"mode-detail"},se={key:0},te={key:1},le={class:"section-card"},ae={key:0,class:"test-section"},oe={class:"form-group"},ne={class:"form-group"},ie={class:"form-group"},de={class:"test-actions"},re=["disabled"],ce={key:0,class:"btn-loading"},ue={class:"result-icon"},ve={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},pe={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},fe={class:"result-content"},_e={class:"result-title"},be={class:"result-client"},me={key:0,class:"result-reason"},ge={__name:"ClientFilter",setup(ye){const a=J({filter_enabled:!1,filter_mode:"simple"}),h=f(!1),m=f([]),g=f(!1),c=f(!1),i=J({user_agent:"",headersJson:"",bodyJson:""}),r=f(null);async function w(){try{const[l,s]=await Promise.all([b.getClientFilterConfig(),b.getClientTypes()]);Object.assign(a,l.data),a.filter_mode||(a.filter_mode="simple"),m.value=s.data||[]}catch(l){console.error("Failed to load data:",l)}}async function k(){h.value=!0;try{await b.updateClientFilterConfig(a),v.success("配置已保存")}catch{await w(),v.error("保存失败")}finally{h.value=!1}}async function V(l){l.enabled=!l.enabled;try{await b.toggleClientType(l.id),v.success(`${l.name} 已${l.enabled?"启用":"禁用"}`)}catch{l.enabled=!l.enabled,v.error("操作失败")}}function B(){i.user_agent="claude-cli/1.0.15 (external, cli)",i.headersJson=JSON.stringify({"x-app":"claude-code","anthropic-version":"2023-06-01","anthropic-beta":"oauth-2025-04-20","x-stainless-os":"Linux"},null,2),i.bodyJson=JSON.stringify({system:[{text:"You are Claude Code, Anthropic's official CLI for Claude."}],metadata:{user_id:"user_d98385411c93cd074b2cefd5c9831fe77f24a53e4ecdcd1f830bba586fe62cb9_account__session_17cf0fd3-d51b-4b59-977d-b899dafb3022"}},null,2)}async function O(){c.value=!0,r.value=null;try{let l={},s={};try{i.headersJson&&(l=JSON.parse(i.headersJson))}catch{v.error("请求头 JSON 格式错误"),c.value=!1;return}try{i.bodyJson&&(s=JSON.parse(i.bodyJson))}catch{v.error("请求体 JSON 格式错误"),c.value=!1;return}const y=await b.testClientFilter({user_agent:i.user_agent,path:"/v1/messages",headers:l,body:s});r.value=y.data}catch{v.error("测试请求失败")}finally{c.value=!1}}return U(w),(l,s)=>{var y;return n(),o("div",A,[s[25]||(s[25]=e("div",{class:"page-header"},[e("div",{class:"header-content"},[e("h1",{class:"page-title"},"客户端过滤"),e("p",{class:"page-subtitle"},"限制只允许指定客户端访问 API")])],-1)),e("div",$,[e("div",E,[e("div",{class:p(["switch-icon",{active:a.filter_enabled}])},[...s[7]||(s[7]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})],-1)])],2),e("div",D,[s[8]||(s[8]=e("h2",null,"客户端过滤",-1)),e("p",null,d(a.filter_enabled?"过滤已启用，只有允许的客户端可以访问":"过滤已关闭，所有请求都将被允许"),1)]),e("label",L,[x(e("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=t=>a.filter_enabled=t),onChange:k,disabled:h.value},null,40,I),[[M,a.filter_enabled]]),s[9]||(s[9]=e("span",{class:"toggle-slider"},null,-1))])])]),a.filter_enabled?u("",!0):(n(),o("div",R,[...s[10]||(s[10]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1),e("span",null,"过滤功能已关闭，所有请求都将被允许通过",-1)])])),a.filter_enabled?(n(),o(N,{key:1},[e("div",z,[e("div",P,[s[11]||(s[11]=e("h3",null,"允许的客户端",-1)),e("span",Y,d(m.value.filter(t=>t.enabled).length)+"/"+d(m.value.length)+" 已启用",1)]),e("div",j,[(n(!0),o(N,null,T(m.value,t=>(n(),o("div",{key:t.id,class:p(["client-card",{enabled:t.enabled}]),onClick:xe=>V(t)},[e("div",G,d(t.icon),1),e("div",H,[e("span",K,d(t.name),1),e("span",Q,d(t.description),1)]),t.enabled?(n(),o("div",W,[...s[12]||(s[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("polyline",{points:"20,6 9,17 4,12"})],-1)])])):u("",!0)],10,q))),128))])]),e("div",X,[s[17]||(s[17]=e("div",{class:"section-header"},[e("h3",null,"验证模式")],-1)),e("div",Z,[e("label",{class:p(["mode-option",{active:a.filter_mode==="simple"}]),onClick:s[1]||(s[1]=t=>{a.filter_mode="simple",k()})},[...s[13]||(s[13]=[S('<div class="mode-radio" data-v-9ac34c5e><span class="radio-dot" data-v-9ac34c5e></span></div><div class="mode-content" data-v-9ac34c5e><span class="mode-title" data-v-9ac34c5e>简单模式</span><span class="mode-desc" data-v-9ac34c5e>宽松验证，User-Agent 匹配即可</span></div>',2)])],2),e("label",{class:p(["mode-option",{active:a.filter_mode==="strict"}]),onClick:s[2]||(s[2]=t=>{a.filter_mode="strict",k()})},[...s[14]||(s[14]=[S('<div class="mode-radio" data-v-9ac34c5e><span class="radio-dot" data-v-9ac34c5e></span></div><div class="mode-content" data-v-9ac34c5e><span class="mode-title" data-v-9ac34c5e>严格模式</span><span class="mode-desc" data-v-9ac34c5e>完整验证，包括请求头和请求体</span></div>',2)])],2)]),e("div",ee,[a.filter_mode==="simple"?(n(),o("p",se,[...s[15]||(s[15]=[e("strong",null,"简单模式",-1),_("：User-Agent 以 ",-1),e("code",null,"claude-cli/版本号",-1),_(" 开头即可通过验证",-1)])])):(n(),o("p",te,[...s[16]||(s[16]=[e("strong",null,"严格模式",-1),_("：User-Agent 必须是完整格式 ",-1),e("code",null,"claude-cli/版本 (external, cli)",-1),_("，并验证请求头",-1)])]))])]),e("div",le,[e("div",{class:"section-header collapsible",onClick:s[3]||(s[3]=t=>g.value=!g.value)},[s[19]||(s[19]=e("h3",null,"验证测试",-1)),(n(),o("svg",{class:p(["expand-icon",{expanded:g.value}]),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[18]||(s[18]=[e("polyline",{points:"6,9 12,15 18,9"},null,-1)])],2))]),g.value?(n(),o("div",ae,[e("div",oe,[s[20]||(s[20]=e("label",{class:"form-label"},"User-Agent",-1)),x(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>i.user_agent=t),type:"text",class:"form-input",placeholder:"claude-cli/1.0.15 (external, cli)"},null,512),[[C,i.user_agent]])]),e("div",ne,[s[21]||(s[21]=e("label",{class:"form-label"},"请求头 (JSON)",-1)),x(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=t=>i.headersJson=t),class:"form-textarea",rows:"2",placeholder:'{"x-app": "claude-code", "anthropic-version": "2023-06-01"}'},null,512),[[C,i.headersJson]])]),e("div",ie,[s[22]||(s[22]=e("label",{class:"form-label"},"请求体 (JSON)",-1)),x(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>i.bodyJson=t),class:"form-textarea",rows:"3",placeholder:'{"system": [{"text": "You are Claude Code..."}]}'},null,512),[[C,i.bodyJson]])]),e("div",de,[e("button",{class:"btn btn-secondary",onClick:B},"填入示例"),e("button",{class:"btn btn-primary",onClick:O,disabled:c.value},[c.value?(n(),o("span",ce)):u("",!0),_(" "+d(c.value?"测试中...":"测试验证"),1)],8,re)]),r.value?(n(),o("div",{key:0,class:p(["test-result",r.value.allowed?"success":"error"])},[e("div",ue,[r.value.allowed?(n(),o("svg",ve,[...s[23]||(s[23]=[e("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"},null,-1),e("polyline",{points:"22,4 12,14.01 9,11.01"},null,-1)])])):(n(),o("svg",pe,[...s[24]||(s[24]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)])]))]),e("div",fe,[e("span",_e,d(r.value.allowed?"验证通过":"验证失败"),1),e("span",be,"客户端: "+d(r.value.client_name||"未识别"),1),(y=r.value.details)!=null&&y.reason?(n(),o("span",me,"原因: "+d(r.value.details.reason),1)):u("",!0)])],2)):u("",!0)])):u("",!0)])],64)):u("",!0)])}}},ke=F(ge,[["__scopeId","data-v-9ac34c5e"]]);export{ke as default};
