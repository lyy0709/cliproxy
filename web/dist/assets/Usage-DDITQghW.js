import{_ as N,a as R,r as d,q as H,o as P,c as o,b as t,s as F,t as l,d as m,f as q,v as L,F as w,x as C,e as u,l as M,n,G as z}from"./index-CQyKkE5B.js";const E={class:"usage-page"},K={class:"page-header"},O=["disabled"],j={class:"stats-section"},J={class:"stats-grid"},Q={class:"stat-card"},W={class:"stat-body"},X={class:"stat-value-row"},Y={class:"stat-value"},Z={class:"stat-card"},tt={class:"stat-body"},st={class:"stat-value-row"},at={class:"stat-value"},et={class:"stat-card"},lt={class:"stat-body"},ot={class:"stat-value-row"},nt={class:"stat-value"},it={class:"stat-card featured"},dt={class:"stat-body"},ct={class:"stat-value-row"},rt={class:"stat-value"},ut={class:"table-section"},vt={class:"section-card"},ht={class:"section-header"},pt={class:"date-controls"},_t={class:"date-picker"},gt={class:"date-shortcuts"},yt=["onClick"],bt={class:"table-wrapper"},ft={key:0,class:"data-table"},xt={class:"date-cell"},mt={class:"text-right"},kt={class:"number-cell"},wt={class:"text-right"},Ct={class:"number-cell"},Mt={class:"text-right"},Bt={class:"cost-cell"},St={key:1,class:"loading-state"},Tt={key:2,class:"empty-state"},Dt={class:"table-section"},Ut={class:"section-card"},Ft={class:"table-wrapper"},qt={key:0,class:"data-table"},Lt={class:"model-badge"},Vt={class:"text-right"},$t={class:"number-cell"},At={class:"text-right"},Gt={class:"number-cell"},It={class:"text-right"},Nt={class:"cost-cell"},Rt={class:"progress-cell"},Ht={class:"progress-bar"},Pt={class:"progress-label"},zt={key:1,class:"loading-state"},Et={key:2,class:"empty-state"},Kt={__name:"Usage",setup(Ot){const i=R({totalRequests:0,totalTokens:0,todayCost:0,totalCost:0}),b=d([]),v=d(!1),h=d([]),p=d(!1),_=d(!1),B=d("最近一周"),S=new Date,V=new Date(S.getTime()-7*24*60*60*1e3),c=d(f(V)),r=d(f(S)),$=[{text:"最近一周",days:7},{text:"最近一月",days:30},{text:"最近三月",days:90}];function f(a){return a.toISOString().split("T")[0]}function A(a){B.value=a.text;const s=new Date,e=new Date;e.setTime(e.getTime()-a.days*24*60*60*1e3),c.value=f(e),r.value=f(s),y(),k()}const T=H(()=>h.value.reduce((a,s)=>a+(s.total_cost||0),0));function D(a){return!T.value||!a?0:Math.round(a/T.value*100)}function g(a){return a?a.toLocaleString():"0"}function G(a){return a?a>=1e6?(a/1e6).toFixed(2)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString():"0"}function x(a){return a==null?"0.0000":a.toFixed(4)}async function U(){try{const a=await M.adminGetUsageSummary();a.data&&(i.totalRequests=a.data.total_requests||0,i.totalTokens=a.data.total_tokens||0,i.todayCost=a.data.today_cost||0,i.totalCost=a.data.total_cost||0)}catch(a){console.error("Failed to fetch summary:",a)}}async function y(){var a;if(!(!c.value||!r.value)){v.value=!0;try{const s=await M.adminGetDailyUsage({start_date:c.value,end_date:r.value});b.value=((a=s.data)==null?void 0:a.daily)||[]}catch(s){console.error("Failed to fetch daily usage:",s)}finally{v.value=!1}}}async function k(){var a;p.value=!0;try{const s=await M.adminGetModelUsage({start_date:c.value,end_date:r.value});h.value=((a=s.data)==null?void 0:a.models)||[]}catch(s){console.error("Failed to fetch model usage:",s)}finally{p.value=!1}}async function I(){_.value=!0,await Promise.all([U(),y(),k()]),_.value=!1}return P(()=>{U(),y(),k()}),(a,s)=>(n(),o("div",E,[t("header",K,[s[3]||(s[3]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"使用统计"),t("p",{class:"page-subtitle"},"查看 API 使用情况和费用统计")],-1)),t("button",{class:"refresh-btn",onClick:I,disabled:_.value},[(n(),o("svg",{class:F(["refresh-icon",{spinning:_.value}]),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...s[2]||(s[2]=[t("path",{d:"M23 4v6h-6M1 20v-6h6"},null,-1),t("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"},null,-1)])],2)),t("span",null,l(_.value?"刷新中...":"刷新"),1)],8,O)]),t("section",j,[t("div",J,[t("div",Q,[s[6]||(s[6]=t("div",{class:"stat-icon requests"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})])],-1)),t("div",W,[s[5]||(s[5]=t("span",{class:"stat-label"},"总请求数",-1)),t("div",X,[t("span",Y,l(g(i.totalRequests)),1),s[4]||(s[4]=t("span",{class:"stat-unit"},"次",-1))])])]),t("div",Z,[s[8]||(s[8]=t("div",{class:"stat-icon tokens"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polygon",{points:"16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88"})])],-1)),t("div",tt,[s[7]||(s[7]=t("span",{class:"stat-label"},"总 Token 消耗",-1)),t("div",st,[t("span",at,l(G(i.totalTokens)),1)])])]),t("div",et,[s[10]||(s[10]=m('<div class="stat-icon today" data-v-139ab17c><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-139ab17c><rect x="3" y="4" width="18" height="18" rx="2" ry="2" data-v-139ab17c></rect><line x1="16" y1="2" x2="16" y2="6" data-v-139ab17c></line><line x1="8" y1="2" x2="8" y2="6" data-v-139ab17c></line><line x1="3" y1="10" x2="21" y2="10" data-v-139ab17c></line></svg></div>',1)),t("div",lt,[s[9]||(s[9]=t("span",{class:"stat-label"},"今日消费",-1)),t("div",ot,[t("span",nt,"$"+l(x(i.todayCost)),1)])])]),t("div",it,[s[12]||(s[12]=t("div",{class:"stat-icon total"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),t("path",{d:"M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"})])],-1)),t("div",dt,[s[11]||(s[11]=t("span",{class:"stat-label"},"总消费",-1)),t("div",ct,[t("span",rt,"$"+l(x(i.totalCost)),1)])])])])]),t("section",ut,[t("div",vt,[t("div",ht,[s[14]||(s[14]=t("div",{class:"section-title-row"},[t("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 3v18h18"}),t("path",{d:"M18 9l-5 5-4-4-3 3"})]),t("h2",null,"每日使用统计")],-1)),t("div",pt,[t("div",_t,[q(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),class:"date-input",onChange:y},null,544),[[L,c.value]]),s[13]||(s[13]=t("span",{class:"date-separator"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),t("polyline",{points:"12,5 19,12 12,19"})])],-1)),q(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>r.value=e),class:"date-input",onChange:y},null,544),[[L,r.value]])]),t("div",gt,[(n(),o(w,null,C($,e=>t("button",{key:e.text,class:F(["shortcut-btn",{active:B.value===e.text}]),onClick:jt=>A(e)},l(e.text),11,yt)),64))])])]),t("div",bt,[!v.value&&b.value.length>0?(n(),o("table",ft,[s[15]||(s[15]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",{class:"text-right"},"请求数"),t("th",{class:"text-right"},"总 Token"),t("th",{class:"text-right"},"费用")])],-1)),t("tbody",null,[(n(!0),o(w,null,C(b.value,e=>(n(),o("tr",{key:e.date,class:"table-row"},[t("td",null,[t("span",xt,l(e.date),1)]),t("td",mt,[t("span",kt,l(g(e.request_count)),1)]),t("td",wt,[t("span",Ct,l(g(e.total_tokens)),1)]),t("td",Mt,[t("span",Bt,"$"+l(x(e.total_cost)),1)])]))),128))])])):u("",!0),v.value?(n(),o("div",St,[...s[16]||(s[16]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):u("",!0),!v.value&&b.value.length===0?(n(),o("div",Tt,[...s[17]||(s[17]=[m('<div class="empty-icon" data-v-139ab17c><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-139ab17c><path d="M3 3v18h18" data-v-139ab17c></path><path d="M18 9l-5 5-4-4-3 3" data-v-139ab17c></path></svg></div><span class="empty-text" data-v-139ab17c>暂无使用记录</span><span class="empty-hint" data-v-139ab17c>选择日期范围查看统计数据</span>',3)])])):u("",!0)])])]),t("section",Dt,[t("div",Ut,[s[21]||(s[21]=m('<div class="section-header" data-v-139ab17c><div class="section-title-row" data-v-139ab17c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-139ab17c><circle cx="12" cy="12" r="10" data-v-139ab17c></circle><polygon points="16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88" data-v-139ab17c></polygon></svg><h2 data-v-139ab17c>按模型统计</h2></div></div>',1)),t("div",Ft,[!p.value&&h.value.length>0?(n(),o("table",qt,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",null,"模型"),t("th",{class:"text-right"},"请求数"),t("th",{class:"text-right"},"总 Token"),t("th",{class:"text-right"},"费用"),t("th",null,"占比")])],-1)),t("tbody",null,[(n(!0),o(w,null,C(h.value,e=>(n(),o("tr",{key:e.model,class:"table-row"},[t("td",null,[t("span",Lt,l(e.model),1)]),t("td",Vt,[t("span",$t,l(g(e.request_count)),1)]),t("td",At,[t("span",Gt,l(g(e.total_tokens)),1)]),t("td",It,[t("span",Nt,"$"+l(x(e.total_cost)),1)]),t("td",null,[t("div",Rt,[t("div",Ht,[t("div",{class:"progress-fill",style:z({width:D(e.total_cost)+"%"})},null,4)]),t("span",Pt,l(D(e.total_cost))+"%",1)])])]))),128))])])):u("",!0),p.value?(n(),o("div",zt,[...s[19]||(s[19]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):u("",!0),!p.value&&h.value.length===0?(n(),o("div",Et,[...s[20]||(s[20]=[m('<div class="empty-icon" data-v-139ab17c><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-139ab17c><circle cx="12" cy="12" r="10" data-v-139ab17c></circle><polygon points="16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88" data-v-139ab17c></polygon></svg></div><span class="empty-text" data-v-139ab17c>暂无模型使用记录</span>',2)])])):u("",!0)])])])]))}},Qt=N(Kt,[["__scopeId","data-v-139ab17c"]]);export{Qt as default};
