import{_ as H,r as d,o as A,c as a,b as e,e as u,d as Q,p as g,f as b,v as x,F as R,x as j,t as i,w as T,M as J,l as v,n,s as z}from"./index-CQyKkE5B.js";const K={class:"gateways-view"},O={class:"page-header"},P={class:"search-bar"},W={class:"search-input-wrapper"},X={class:"gateway-list"},Y={key:0,class:"loading-state"},Z={key:1,class:"empty-state"},ee={key:2,class:"gateway-grid"},se={class:"card-header"},te={class:"gateway-info"},le={class:"gateway-name"},oe={key:0,class:"default-badge"},ae={class:"gateway-url"},ne={class:"gateway-status"},ie={key:0,class:"latency"},de={class:"card-body"},re={class:"info-row"},ue={class:"value"},ce={key:0,class:"info-row"},ve={class:"value"},pe={key:1,class:"info-row error"},me={class:"value"},be={class:"card-footer"},fe={class:"toggle-wrapper"},ke={class:"toggle"},ye=["checked","onChange"],_e={class:"toggle-label"},he={class:"actions"},ge=["onClick"],xe=["onClick"],we=["onClick"],Ce=["onClick"],Me={key:0,class:"pagination"},Ge=["disabled"],Be=["disabled"],Ve={class:"modal"},$e={class:"modal-header"},Te={class:"modal-body"},ze={class:"form-group"},De={class:"form-group"},Ue={class:"form-group"},Se={class:"form-group"},Ne={class:"toggle-inline"},Ee={class:"modal-footer"},Ie=["disabled"],Le={class:"modal modal-sm"},qe={class:"modal-header"},Fe={class:"modal-body"},He={class:"modal-footer"},Ae={__name:"Gateways",setup(Qe){const w=d(!1),C=d([]),f=d(0),c=d(1),k=d(20),M=d(""),G=d(!1),p=d(!1),m=d(!1),y=d(null),B=d(null),o=d({name:"",url:"",remark:"",enabled:!0});async function r(){w.value=!0;try{const l=await v.getGateways({page:c.value,page_size:k.value,search:M.value});C.value=l.items||[],f.value=l.total||0}catch(l){console.error("加载网关失败:",l)}finally{w.value=!1}}let V;function D(){clearTimeout(V),V=setTimeout(()=>{c.value=1,r()},300)}function U(l){return{success:"正常",failed:"异常",pending:"未测试"}[l]||"未测试"}async function S(l){try{await v.toggleGateway(l.id),r()}catch(s){console.error("切换状态失败:",s)}}async function N(l){try{await v.testGatewayById(l.id),r()}catch(s){console.error("测试失败:",s)}}async function E(l){try{await v.setDefaultGateway(l.id),r()}catch(s){console.error("设置默认失败:",s)}}function I(l){B.value=l,o.value={name:l.name,url:l.url,remark:l.remark||"",enabled:l.enabled},p.value=!0}function L(l){y.value=l,m.value=!0}async function q(){try{await v.deleteGateway(y.value.id),m.value=!1,y.value=null,r()}catch(l){alert(l.message||"删除失败")}}async function F(){try{p.value?await v.updateGateway(B.value.id,o.value):await v.createGateway(o.value),_(),r()}catch(l){alert(l.message||"保存失败")}}function _(){G.value=!1,p.value=!1,B.value=null,o.value={name:"",url:"",remark:"",enabled:!0}}return A(r),(l,s)=>{var $;return n(),a("div",K,[e("div",O,[s[12]||(s[12]=Q('<div class="header-content" data-v-77c541de><h1 class="page-title" data-v-77c541de><svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-77c541de><circle cx="12" cy="12" r="10" data-v-77c541de></circle><line x1="2" y1="12" x2="22" y2="12" data-v-77c541de></line><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" data-v-77c541de></path></svg> 网关管理 </h1><p class="page-desc" data-v-77c541de>管理 xyrt 授权专用的网关配置，用于替换 chatgpt.com 域名</p></div>',1)),e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=t=>G.value=!0)},[...s[11]||(s[11]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),g(" 添加网关 ",-1)])])]),e("div",P,[e("div",W,[s[13]||(s[13]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),b(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>M.value=t),type:"text",class:"search-input",placeholder:"搜索网关名称或地址...",onInput:D},null,544),[[x,M.value]])])]),e("div",X,[w.value?(n(),a("div",Y,[...s[14]||(s[14]=[e("div",{class:"spinner"},null,-1),e("span",null,"加载中...",-1)])])):C.value.length===0?(n(),a("div",Z,[...s[15]||(s[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e("path",{d:"M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"})],-1),e("h3",null,"暂无网关配置",-1),e("p",null,'点击上方"添加网关"按钮创建第一个网关',-1)])])):(n(),a("div",ee,[(n(!0),a(R,null,j(C.value,t=>(n(),a("div",{key:t.id,class:z(["gateway-card",{disabled:!t.enabled,default:t.is_default}])},[e("div",se,[e("div",te,[e("h3",le,[g(i(t.name)+" ",1),t.is_default?(n(),a("span",oe,"默认")):u("",!0)]),e("p",ae,i(t.url),1)]),e("div",ne,[e("span",{class:z(["status-badge",t.test_status||"pending"])},i(U(t.test_status)),3),t.test_latency>0?(n(),a("span",ie,i(t.test_latency)+"ms ",1)):u("",!0)])]),e("div",de,[e("div",re,[s[16]||(s[16]=e("span",{class:"label"},"Codex URL:",-1)),e("code",ue,i(t.url)+"/backend-api/codex",1)]),t.remark?(n(),a("div",ce,[s[17]||(s[17]=e("span",{class:"label"},"备注:",-1)),e("span",ve,i(t.remark),1)])):u("",!0),t.test_error?(n(),a("div",pe,[s[18]||(s[18]=e("span",{class:"label"},"错误:",-1)),e("span",me,i(t.test_error),1)])):u("",!0)]),e("div",be,[e("div",fe,[e("label",ke,[e("input",{type:"checkbox",checked:t.enabled,onChange:h=>S(t)},null,40,ye),s[19]||(s[19]=e("span",{class:"toggle-slider"},null,-1))]),e("span",_e,i(t.enabled?"已启用":"已禁用"),1)]),e("div",he,[e("button",{class:"btn-icon",title:"测试连接",onClick:h=>N(t)},[...s[20]||(s[20]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1)])],8,ge),!t.is_default&&t.enabled?(n(),a("button",{key:0,class:"btn-icon",title:"设为默认",onClick:h=>E(t)},[...s[21]||(s[21]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})],-1)])],8,xe)):u("",!0),e("button",{class:"btn-icon",title:"编辑",onClick:h=>I(t)},[...s[22]||(s[22]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,we),e("button",{class:"btn-icon danger",title:"删除",onClick:h=>L(t)},[...s[23]||(s[23]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Ce)])])],2))),128))]))]),f.value>k.value?(n(),a("div",Me,[e("button",{disabled:c.value===1,onClick:s[2]||(s[2]=t=>{c.value--,r()})},"上一页",8,Ge),e("span",null,i(c.value)+" / "+i(Math.ceil(f.value/k.value)),1),e("button",{disabled:c.value>=Math.ceil(f.value/k.value),onClick:s[3]||(s[3]=t=>{c.value++,r()})},"下一页",8,Be)])):u("",!0),G.value||p.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:T(_,["self"])},[e("div",Ve,[e("div",$e,[e("h2",null,i(p.value?"编辑网关":"添加网关"),1),e("button",{class:"close-btn",onClick:_},"×")]),e("div",Te,[e("div",ze,[s[24]||(s[24]=e("label",{class:"form-label required"},"网关名称",-1)),b(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.value.name=t),type:"text",class:"form-input",placeholder:"例如：主网关"},null,512),[[x,o.value.name]])]),e("div",De,[s[25]||(s[25]=e("label",{class:"form-label required"},"网关地址",-1)),b(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.value.url=t),type:"text",class:"form-input",placeholder:"例如：https://gateway.example.com"},null,512),[[x,o.value.url]]),s[26]||(s[26]=e("p",{class:"form-tip"},"网关地址用于替换 chatgpt.com，请求将发送到 网关/backend-api/codex",-1))]),e("div",Ue,[s[27]||(s[27]=e("label",{class:"form-label"},"备注",-1)),b(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.value.remark=t),class:"form-textarea",placeholder:"可选备注信息"},null,512),[[x,o.value.remark]])]),e("div",Se,[e("label",Ne,[b(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>o.value.enabled=t),type:"checkbox"},null,512),[[J,o.value.enabled]]),s[28]||(s[28]=e("span",null,"启用网关",-1))])])]),e("div",Ee,[e("button",{class:"btn btn-secondary",onClick:_},"取消"),e("button",{class:"btn btn-primary",disabled:!o.value.name||!o.value.url,onClick:F},i(p.value?"保存":"添加"),9,Ie)])])])):u("",!0),m.value?(n(),a("div",{key:2,class:"modal-overlay",onClick:s[10]||(s[10]=T(t=>m.value=!1,["self"]))},[e("div",Le,[e("div",qe,[s[29]||(s[29]=e("h2",null,"确认删除",-1)),e("button",{class:"close-btn",onClick:s[8]||(s[8]=t=>m.value=!1)},"×")]),e("div",Fe,[e("p",null,[s[30]||(s[30]=g("确定要删除网关 ",-1)),e("strong",null,i(($=y.value)==null?void 0:$.name),1),s[31]||(s[31]=g(" 吗？",-1))]),s[32]||(s[32]=e("p",{class:"warning-text"},"此操作不可恢复。",-1))]),e("div",He,[e("button",{class:"btn btn-secondary",onClick:s[9]||(s[9]=t=>m.value=!1)},"取消"),e("button",{class:"btn btn-danger",onClick:q},"确认删除")])])])):u("",!0)])}}},je=H(Ae,[["__scopeId","data-v-77c541de"]]);export{je as default};
