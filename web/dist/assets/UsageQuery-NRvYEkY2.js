import{_ as K,r as u,q as F,c as l,b as t,e as r,d as C,f as L,v as I,h as N,t as o,s as T,F as M,x as B,i as A,j as P,k as S,n as i,p as V}from"./index-CQyKkE5B.js";const $={class:"usage-query-page"},j={class:"query-card"},z={class:"query-form"},E={class:"input-group"},Q={class:"input-wrapper"},U=["disabled"],H={key:0,class:"spinner",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},G={key:1},J={key:0,class:"error-alert"},O={key:0,class:"empty-state"},R={key:0,class:"result-container"},W={class:"key-info-card"},X={class:"key-info-header"},Y={class:"key-name"},Z={class:"stats-section"},tt={class:"stats-grid"},st={class:"stat-card"},et={class:"stat-content"},at={class:"stat-value"},ot={class:"stat-card"},lt={class:"stat-content"},it={class:"stat-value"},nt={class:"stat-card"},rt={class:"stat-content"},dt={class:"stat-value"},ct={class:"stats-section"},ut={class:"stats-grid compact"},vt={class:"stat-card mini"},_t={class:"stat-value-sm"},ht={class:"stat-card mini"},pt={class:"stat-value-sm"},yt={class:"stat-card mini"},ft={class:"stat-value-sm"},kt={key:0,class:"quota-section"},xt={class:"quota-card"},mt={key:0,class:"quota-item"},gt={class:"quota-value"},wt={key:1,class:"quota-item"},bt={class:"quota-value"},qt={key:2,class:"quota-item"},Ct={class:"quota-value"},Mt={key:1,class:"model-section"},Bt={class:"table-card"},Dt={class:"data-table"},Kt={class:"text-left"},Ft={class:"model-name"},Lt={class:"text-right"},It={class:"text-right"},Nt={class:"text-right"},Tt={class:"trend-section"},At={class:"section-header"},Pt=["disabled"],St={key:0,class:"spinner-sm",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Vt={key:1},$t={key:0,class:"table-card"},jt={class:"data-table"},zt={class:"text-left"},Et={class:"text-right"},Qt={class:"text-right"},Ut={class:"text-right"},Ht={key:1,class:"empty-table"},Gt={class:"footer-link"},Jt={__name:"UsageQuery",setup(Ot){const d=u(""),v=u(!1),h=u(!1),e=u(null),p=u([]),c=u(""),g=F(()=>{var a;return(a=e.value)!=null&&a.expires_at?new Date(e.value.expires_at)<new Date:!1});async function w(){if(!d.value.trim()){c.value="请输入 API Key";return}v.value=!0,c.value="",e.value=null,p.value=[];try{const a=await fetch("/api/key/usage",{headers:{"x-api-key":d.value.trim()}}),s=await a.json();if(!a.ok)throw new Error(s.message||s.error||"查询失败");e.value=s.data,await b()}catch(a){c.value=a.message||"查询失败，请检查 API Key"}finally{v.value=!1}}async function b(){var a;if(d.value.trim()){h.value=!0;try{const s=await fetch("/api/key/usage/daily",{headers:{"x-api-key":d.value.trim()}}),k=await s.json();s.ok&&((a=k.data)!=null&&a.stats)&&(p.value=[...k.data.stats].sort((x,m)=>new Date(m.date)-new Date(x.date)))}catch(s){console.error("加载每日统计失败:",s)}finally{h.value=!1}}}function y(a){return a?a.toLocaleString():"0"}function f(a){return a?a>=1e6?(a/1e6).toFixed(2)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString():"0"}function D(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}return(a,s)=>{var x,m,q;const k=S("router-link");return i(),l("div",$,[s[28]||(s[28]=t("div",{class:"bg-decoration"},[t("div",{class:"bg-circle bg-circle-1"}),t("div",{class:"bg-circle bg-circle-2"})],-1)),t("div",j,[s[5]||(s[5]=C('<div class="query-header" data-v-cf87e093><div class="header-icon" data-v-cf87e093><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-cf87e093><path d="M22 12h-4l-3 9L9 3l-3 9H2" data-v-cf87e093></path></svg></div><h1 class="header-title" data-v-cf87e093>用量查询</h1><p class="header-subtitle" data-v-cf87e093>输入 API Key 查看使用统计</p></div>',1)),t("div",z,[t("div",E,[t("div",Q,[s[1]||(s[1]=t("svg",{class:"input-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"})],-1)),L(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>d.value=n),type:"password",class:"form-input",placeholder:"请输入 API Key",onKeyup:N(w,["enter"])},null,544),[[I,d.value]])]),t("button",{class:"btn-query",disabled:v.value,onClick:w},[v.value?(i(),l("svg",H,[...s[2]||(s[2]=[t("circle",{cx:"12",cy:"12",r:"10","stroke-opacity":"0.25"},null,-1),t("path",{d:"M12 2a10 10 0 019.95 9","stroke-linecap":"round"},null,-1)])])):(i(),l("span",G,"查询"))],8,U)]),c.value?(i(),l("div",J,[s[3]||(s[3]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),t("span",null,o(c.value),1)])):r("",!0)]),!e.value&&!v.value&&!c.value?(i(),l("div",O,[...s[4]||(s[4]=[C('<div class="empty-icon" data-v-cf87e093><svg viewBox="0 0 80 80" fill="none" stroke="currentColor" stroke-width="1.5" data-v-cf87e093><rect x="10" y="20" width="60" height="40" rx="4" data-v-cf87e093></rect><path d="M10 30h60M25 40h30M25 50h20" stroke-linecap="round" data-v-cf87e093></path></svg></div><p class="empty-text" data-v-cf87e093>输入 API Key 开始查询</p>',2)])])):r("",!0)]),e.value?(i(),l("div",R,[t("div",W,[t("div",X,[t("div",Y,[t("h2",null,o(e.value.key_name||"API Key"),1),t("span",{class:T(["status-badge",g.value?"expired":"active"])},o(g.value?"已过期":"有效"),3)])])]),t("div",Z,[s[12]||(s[12]=t("div",{class:"section-header"},[t("h3",null,"总计")],-1)),t("div",tt,[t("div",st,[s[7]||(s[7]=t("div",{class:"stat-icon requests"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})])],-1)),t("div",et,[t("span",at,o(y(e.value.total_requests)),1),s[6]||(s[6]=t("span",{class:"stat-label"},"请求数",-1))])]),t("div",ot,[s[9]||(s[9]=t("div",{class:"stat-icon tokens"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 6v12M6 12h12"})])],-1)),t("div",lt,[t("span",it,o(f(e.value.total_tokens)),1),s[8]||(s[8]=t("span",{class:"stat-label"},"Token",-1))])]),t("div",nt,[s[11]||(s[11]=t("div",{class:"stat-icon cost"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 6v2m0 8v2M9 10c0-1.1.9-2 2-2h2a2 2 0 010 4h-2a2 2 0 000 4h2a2 2 0 002-2"})])],-1)),t("div",rt,[t("span",dt,"$"+o(((x=e.value.total_cost)==null?void 0:x.toFixed(4))||"0.00"),1),s[10]||(s[10]=t("span",{class:"stat-label"},"费用",-1))])])])]),t("div",ct,[s[16]||(s[16]=t("div",{class:"section-header"},[t("h3",null,"今日")],-1)),t("div",ut,[t("div",vt,[t("span",_t,o(y(e.value.today_requests)),1),s[13]||(s[13]=t("span",{class:"stat-label"},"请求",-1))]),t("div",ht,[t("span",pt,o(f(e.value.today_tokens)),1),s[14]||(s[14]=t("span",{class:"stat-label"},"Token",-1))]),t("div",yt,[t("span",ft,"$"+o(((m=e.value.today_cost)==null?void 0:m.toFixed(4))||"0.00"),1),s[15]||(s[15]=t("span",{class:"stat-label"},"费用",-1))])])]),e.value.daily_limit||e.value.monthly_quota||e.value.expires_at?(i(),l("div",kt,[s[20]||(s[20]=t("div",{class:"section-header"},[t("h3",null,"配额")],-1)),t("div",xt,[e.value.daily_limit?(i(),l("div",mt,[s[17]||(s[17]=t("span",{class:"quota-label"},"每日限额",-1)),t("span",gt,o(e.value.daily_limit)+" 次",1)])):r("",!0),e.value.monthly_quota?(i(),l("div",wt,[s[18]||(s[18]=t("span",{class:"quota-label"},"月度配额",-1)),t("span",bt,"$"+o(e.value.monthly_quota),1)])):r("",!0),e.value.expires_at?(i(),l("div",qt,[s[19]||(s[19]=t("span",{class:"quota-label"},"过期时间",-1)),t("span",Ct,o(D(e.value.expires_at)),1)])):r("",!0)])])):r("",!0),(q=e.value.model_stats)!=null&&q.length?(i(),l("div",Mt,[s[22]||(s[22]=t("div",{class:"section-header"},[t("h3",null,"模型分布")],-1)),t("div",Bt,[t("table",Dt,[s[21]||(s[21]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"模型"),t("th",{class:"text-right"},"请求"),t("th",{class:"text-right"},"Token"),t("th",{class:"text-right"},"费用")])],-1)),t("tbody",null,[(i(!0),l(M,null,B(e.value.model_stats,n=>{var _;return i(),l("tr",{key:n.model},[t("td",Kt,[t("span",Ft,o(n.model),1)]),t("td",Lt,o(y(n.request_count)),1),t("td",It,o(f(n.total_tokens)),1),t("td",Nt,"$"+o((_=n.total_cost)==null?void 0:_.toFixed(4)),1)])}),128))])])])])):r("",!0),t("div",Tt,[t("div",At,[s[24]||(s[24]=t("h3",null,"每日趋势",-1)),t("button",{class:"btn-refresh",onClick:b,disabled:h.value},[h.value?(i(),l("svg",St,[...s[23]||(s[23]=[t("circle",{cx:"12",cy:"12",r:"10","stroke-opacity":"0.25"},null,-1),t("path",{d:"M12 2a10 10 0 019.95 9","stroke-linecap":"round"},null,-1)])])):(i(),l("span",Vt,"刷新"))],8,Pt)]),p.value.length?(i(),l("div",$t,[t("table",jt,[s[25]||(s[25]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"日期"),t("th",{class:"text-right"},"请求"),t("th",{class:"text-right"},"Token"),t("th",{class:"text-right"},"费用")])],-1)),t("tbody",null,[(i(!0),l(M,null,B(p.value.slice(0,14),n=>{var _;return i(),l("tr",{key:n.date},[t("td",zt,o(n.date),1),t("td",Et,o(y(n.request_count)),1),t("td",Qt,o(f(n.total_tokens)),1),t("td",Ut,"$"+o((_=n.total_cost)==null?void 0:_.toFixed(4)),1)])}),128))])])])):(i(),l("div",Ht,[...s[26]||(s[26]=[t("p",null,"暂无数据",-1)])]))]),t("div",Gt,[A(k,{to:"/",class:"back-link"},{default:P(()=>[...s[27]||(s[27]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t("polyline",{points:"12,19 5,12 12,5"})],-1),V(" 返回首页 ",-1)])]),_:1})])])):r("",!0)])}}},Wt=K(Jt,[["__scopeId","data-v-cf87e093"]]);export{Wt as default};
