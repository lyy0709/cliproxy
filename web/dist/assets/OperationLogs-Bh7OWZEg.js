import{_ as G,r as v,a as U,N as Q,o as R,c as d,b as s,z as I,p as w,s as h,f as m,L,F as z,x as S,v as M,e as u,t as l,w as E,T as F,l as q,E as A,n as i}from"./index-CQyKkE5B.js";const W={class:"operation-logs-page"},X={class:"page-header"},Y={class:"header-actions"},Z=["disabled"],ss={class:"filter-card"},ts={class:"filter-row"},es={class:"filter-group"},ls=["value"],as={class:"filter-group"},os=["value"],ns={class:"filter-group"},is={class:"date-inputs"},ds={class:"filter-group search-group"},us={class:"search-box"},rs={class:"table-card"},ps={class:"table-container"},vs={class:"data-table"},cs={key:0},gs={class:"row-index"},ms={class:"log-time"},_s={class:"user-cell"},bs={class:"username"},fs={class:"user-ip"},hs={class:"description-cell"},ys={class:"description"},ks={key:0,class:"target"},Cs={class:"path-cell"},xs={class:"path"},ws={class:"duration"},Ls=["onClick"],zs={key:0,class:"loading-state"},Ss={key:1,class:"empty-state"},Ms={key:0,class:"table-footer"},Vs={class:"pagination-info"},Bs={class:"pagination-controls"},Ts={class:"page-btns"},$s=["disabled"],Ds={class:"page-current"},Ns=["disabled"],Os={class:"modal modal-lg"},Us={class:"modal-header"},Is={key:0,class:"modal-body"},Es={class:"detail-grid"},Fs={class:"detail-item"},qs={class:"detail-value"},As={class:"detail-item"},Js={class:"detail-value"},Ps={class:"detail-item"},js={class:"detail-value"},Hs={class:"detail-item"},Ks={class:"detail-value mono"},Gs={class:"detail-item"},Qs={class:"detail-value"},Rs={class:"detail-item"},Ws={class:"detail-value"},Xs={class:"detail-item"},Ys={class:"detail-value"},Zs={class:"detail-item"},st={class:"detail-value"},tt={class:"detail-item full"},et={class:"detail-value"},lt={class:"detail-item"},at={class:"detail-value mono"},ot={class:"detail-item"},nt={class:"detail-value mono"},it={class:"detail-item"},dt={class:"detail-value"},ut={class:"detail-item"},rt={class:"detail-value"},pt={class:"detail-item"},vt={class:"detail-value"},ct={class:"detail-item full"},gt={class:"detail-value ua"},mt={key:0,class:"detail-item full"},_t={class:"request-body"},bt={class:"modal-footer"},ft={class:"modal modal-sm"},ht={class:"modal-footer"},yt=["disabled"],kt={key:0,class:"btn-loading"},Ct={__name:"OperationLogs",setup(xt){const c=v(!1),k=v([]),_=v(!1),n=v(null),b=v(!1),f=v(!1),C=v(""),x=v(""),o=U({page:1,pageSize:20,total:0}),r=U({module:"",action:"",search:"",start_time:"",end_time:""}),V={auth:"认证",user:"用户",account:"账户",apikey:"API Key",model:"模型",config:"配置",cache:"缓存",proxy:"代理",package:"套餐",group:"分组",system:"系统"},B={login:"登录",create:"创建",update:"更新",delete:"删除",clear:"清除"};function T(a){return V[a]||a}function $(a){return B[a]||a}function D(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}function J(a){try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}}let y=null;function P(){clearTimeout(y),y=setTimeout(()=>{o.page=1,p()},300)}Q(()=>{y&&clearTimeout(y)});function N(){r.start_time=C.value||"",r.end_time=x.value||"",o.page=1,p()}function O(){o.page=1,p()}async function p(){c.value=!0;try{const a={page:o.page,page_size:o.pageSize,...r};Object.keys(a).forEach(e=>{a[e]||delete a[e]});const t=await q.getOperationLogs(a);k.value=t.data.items||[],o.total=t.data.total||0}catch(a){console.error("Failed to load logs:",a)}finally{c.value=!1}}function j(a){n.value=a,_.value=!0}function H(){b.value=!0}async function K(){f.value=!0;try{const a=await q.cleanupOperationLogs(90);A.success(`清理完成，删除了 ${a.data.deleted} 条记录`),b.value=!1,p()}catch{A.error("清理失败")}finally{f.value=!1}}return R(()=>{p()}),(a,t)=>(i(),d("div",W,[s("div",X,[t[16]||(t[16]=s("div",{class:"header-content"},[s("h1",{class:"page-title"},"操作日志"),s("p",{class:"page-subtitle"},"记录系统所有操作行为，便于审计和追溯")],-1)),s("div",Y,[s("button",{class:"btn btn-outline",onClick:p,disabled:c.value},[(i(),d("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:h({spinning:c.value})},[...t[13]||(t[13]=[s("polyline",{points:"23,4 23,10 17,10"},null,-1),s("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"},null,-1)])],2)),t[14]||(t[14]=w(" 刷新 ",-1))],8,Z),s("button",{class:"btn btn-warning",onClick:H},[...t[15]||(t[15]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),w(" 清理旧日志 ",-1)])])])]),s("div",ss,[s("div",ts,[s("div",es,[t[18]||(t[18]=s("label",{class:"filter-label"},"模块",-1)),m(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.module=e),onChange:O,class:"filter-select"},[t[17]||(t[17]=s("option",{value:""},"全部模块",-1)),(i(),d(z,null,S(V,(e,g)=>s("option",{key:g,value:g},l(e),9,ls)),64))],544),[[L,r.module]])]),s("div",as,[t[20]||(t[20]=s("label",{class:"filter-label"},"操作",-1)),m(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.action=e),onChange:O,class:"filter-select"},[t[19]||(t[19]=s("option",{value:""},"全部操作",-1)),(i(),d(z,null,S(B,(e,g)=>s("option",{key:g,value:g},l(e),9,os)),64))],544),[[L,r.action]])]),s("div",ns,[t[22]||(t[22]=s("label",{class:"filter-label"},"时间范围",-1)),s("div",is,[m(s("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),class:"date-input",onChange:N},null,544),[[M,C.value]]),t[21]||(t[21]=s("span",{class:"date-sep"},"至",-1)),m(s("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=e=>x.value=e),class:"date-input",onChange:N},null,544),[[M,x.value]])])]),s("div",ds,[t[24]||(t[24]=s("label",{class:"filter-label"},"搜索",-1)),s("div",us,[t[23]||(t[23]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),m(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.search=e),placeholder:"用户/描述/路径...",onInput:P},null,544),[[M,r.search]])])])])]),s("div",rs,[s("div",ps,[s("table",vs,[t[26]||(t[26]=s("thead",null,[s("tr",null,[s("th",{width:"50"},"#"),s("th",{width:"160"},"时间"),s("th",{width:"120"},"用户"),s("th",{width:"90"},"模块"),s("th",{width:"80"},"操作"),s("th",null,"描述"),s("th",{width:"180"},"路径"),s("th",{width:"80"},"结果"),s("th",{width:"70"},"耗时"),s("th",{width:"60"},"操作")])],-1)),c.value?u("",!0):(i(),d("tbody",cs,[(i(!0),d(z,null,S(k.value,(e,g)=>(i(),d("tr",{key:e.id},[s("td",null,[s("span",gs,l((o.page-1)*o.pageSize+g+1),1)]),s("td",null,[s("span",ms,l(D(e.created_at)),1)]),s("td",null,[s("div",_s,[s("span",bs,l(e.username||"-"),1),s("span",fs,l(e.ip),1)])]),s("td",null,[s("span",{class:h(["module-badge",e.module])},l(T(e.module)),3)]),s("td",null,[s("span",{class:h(["action-badge",e.action])},l($(e.action)),3)]),s("td",null,[s("div",hs,[s("span",ys,l(e.description),1),e.target_name?(i(),d("span",ks,"→ "+l(e.target_name),1)):u("",!0)])]),s("td",null,[s("div",Cs,[s("span",{class:h(["method-badge",e.method])},l(e.method),3),s("span",xs,l(e.path),1)])]),s("td",null,[s("span",{class:h(["result-badge",e.response_code===0?"success":"error"])},l(e.response_code===0?"成功":"失败"),3)]),s("td",null,[s("span",ws,l(e.duration)+"ms",1)]),s("td",null,[s("button",{class:"action-btn",onClick:wt=>j(e),title:"详情"},[...t[25]||(t[25]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s("circle",{cx:"12",cy:"12",r:"3"})],-1)])],8,Ls)])]))),128))]))]),c.value?(i(),d("div",zs,[...t[27]||(t[27]=[s("div",{class:"loading-spinner"},null,-1),s("span",null,"加载中...",-1)])])):u("",!0),!c.value&&k.value.length===0?(i(),d("div",Ss,[...t[28]||(t[28]=[s("span",null,"暂无日志记录",-1)])])):u("",!0)]),o.total>0?(i(),d("div",Ms,[s("div",Vs,"共 "+l(o.total)+" 条",1),s("div",Bs,[m(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>o.pageSize=e),onChange:p,class:"page-size-select"},[...t[29]||(t[29]=[s("option",{value:20},"20 条/页",-1),s("option",{value:50},"50 条/页",-1),s("option",{value:100},"100 条/页",-1)])],544),[[L,o.pageSize]]),s("div",Ts,[s("button",{class:"page-btn",disabled:o.page<=1,onClick:t[6]||(t[6]=e=>{o.page--,p()})},[...t[30]||(t[30]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,$s),s("span",Ds,l(o.page)+" / "+l(Math.ceil(o.total/o.pageSize)||1),1),s("button",{class:"page-btn",disabled:o.page>=Math.ceil(o.total/o.pageSize),onClick:t[7]||(t[7]=e=>{o.page++,p()})},[...t[31]||(t[31]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,Ns)])])])):u("",!0)]),(i(),I(F,{to:"body"},[_.value?(i(),d("div",{key:0,class:"modal-overlay",onClick:t[10]||(t[10]=E(e=>_.value=!1,["self"]))},[s("div",Os,[s("div",Us,[t[33]||(t[33]=s("h2",null,"操作日志详情",-1)),s("button",{class:"modal-close",onClick:t[8]||(t[8]=e=>_.value=!1)},[...t[32]||(t[32]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),n.value?(i(),d("div",Is,[s("div",Es,[s("div",Fs,[t[34]||(t[34]=s("span",{class:"detail-label"},"ID",-1)),s("span",qs,l(n.value.id),1)]),s("div",As,[t[35]||(t[35]=s("span",{class:"detail-label"},"时间",-1)),s("span",Js,l(D(n.value.created_at)),1)]),s("div",Ps,[t[36]||(t[36]=s("span",{class:"detail-label"},"用户",-1)),s("span",js,l(n.value.username)+" (ID: "+l(n.value.user_id)+")",1)]),s("div",Hs,[t[37]||(t[37]=s("span",{class:"detail-label"},"IP",-1)),s("span",Ks,l(n.value.ip),1)]),s("div",Gs,[t[38]||(t[38]=s("span",{class:"detail-label"},"模块",-1)),s("span",Qs,l(T(n.value.module)),1)]),s("div",Rs,[t[39]||(t[39]=s("span",{class:"detail-label"},"操作",-1)),s("span",Ws,l($(n.value.action)),1)]),s("div",Xs,[t[40]||(t[40]=s("span",{class:"detail-label"},"目标ID",-1)),s("span",Ys,l(n.value.target_id||"-"),1)]),s("div",Zs,[t[41]||(t[41]=s("span",{class:"detail-label"},"目标名称",-1)),s("span",st,l(n.value.target_name||"-"),1)]),s("div",tt,[t[42]||(t[42]=s("span",{class:"detail-label"},"描述",-1)),s("span",et,l(n.value.description),1)]),s("div",lt,[t[43]||(t[43]=s("span",{class:"detail-label"},"请求方法",-1)),s("span",at,l(n.value.method),1)]),s("div",ot,[t[44]||(t[44]=s("span",{class:"detail-label"},"请求路径",-1)),s("span",nt,l(n.value.path),1)]),s("div",it,[t[45]||(t[45]=s("span",{class:"detail-label"},"响应码",-1)),s("span",dt,l(n.value.response_code),1)]),s("div",ut,[t[46]||(t[46]=s("span",{class:"detail-label"},"响应消息",-1)),s("span",rt,l(n.value.response_msg||"-"),1)]),s("div",pt,[t[47]||(t[47]=s("span",{class:"detail-label"},"耗时",-1)),s("span",vt,l(n.value.duration)+"ms",1)]),s("div",ct,[t[48]||(t[48]=s("span",{class:"detail-label"},"User-Agent",-1)),s("span",gt,l(n.value.user_agent||"-"),1)]),n.value.request_body?(i(),d("div",mt,[t[49]||(t[49]=s("span",{class:"detail-label"},"请求体",-1)),s("pre",_t,l(J(n.value.request_body)),1)])):u("",!0)])])):u("",!0),s("div",bt,[s("button",{class:"btn btn-secondary",onClick:t[9]||(t[9]=e=>_.value=!1)},"关闭")])])])):u("",!0)])),(i(),I(F,{to:"body"},[b.value?(i(),d("div",{key:0,class:"modal-overlay",onClick:t[12]||(t[12]=E(e=>b.value=!1,["self"]))},[s("div",ft,[t[50]||(t[50]=s("div",{class:"modal-header danger"},[s("div",{class:"danger-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),s("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])]),s("h2",null,"确认清理")],-1)),t[51]||(t[51]=s("div",{class:"modal-body"},[s("p",{class:"delete-message"},"确定要清理 90 天前的日志吗？此操作不可恢复。")],-1)),s("div",ht,[s("button",{class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>b.value=!1)},"取消"),s("button",{class:"btn btn-danger",disabled:f.value,onClick:K},[f.value?(i(),d("span",kt)):u("",!0),w(" "+l(f.value?"清理中...":"确认清理"),1)],8,yt)])])])):u("",!0)]))]))}},zt=G(Ct,[["__scopeId","data-v-7226d587"]]);export{zt as default};
