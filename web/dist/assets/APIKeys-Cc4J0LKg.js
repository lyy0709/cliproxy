import{_ as at,r as u,a as q,o as nt,c as i,b as t,z as A,p as D,e as c,F as R,x as j,t as a,f as p,L as J,w as P,T as L,v as m,s as F,l as K,E as f,n,d as it}from"./index-CQyKkE5B.js";const dt={class:"apikeys-page"},rt={class:"table-card"},ut={class:"table-container"},ct={class:"data-table"},pt={key:0},vt={class:"col-id"},mt={class:"col-name"},ft={class:"key-name"},gt={class:"col-prefix"},yt={class:"key-prefix"},_t={class:"col-status"},bt={class:"col-rate"},kt={class:"rate-info"},wt={class:"col-requests"},xt={class:"col-cost"},ht={class:"cost"},Ct={class:"col-time"},Vt={class:"col-actions"},Kt={class:"action-group"},zt=["onClick"],Bt=["onClick","title"],St={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},$t={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},It=["onClick"],Mt={key:0,class:"loading-state"},At={key:1,class:"empty-state"},Dt={key:0,class:"pagination-wrap"},Pt={class:"pagination-info"},Lt={class:"pagination-controls"},Tt={class:"page-btns"},Ut=["disabled"],qt={class:"page-current"},Ft=["disabled"],Nt={class:"modal modal-xl"},Et={class:"modal-header"},Ht={class:"modal-title-group"},Gt={class:"modal-badges"},Ot={class:"badge badge-success"},Rt={class:"badge badge-warning"},jt={class:"modal-body"},Jt={class:"log-table-container"},Qt={class:"data-table compact"},Wt={key:0},Xt={class:"model-name"},Yt={class:"cost"},Zt={key:0,class:"loading-state small"},te={key:1,class:"empty-state small"},ee={key:0,class:"log-pagination"},le={class:"pagination-info"},se={class:"pagination-controls"},oe={class:"page-btns"},ae=["disabled"],ne={class:"page-current"},ie=["disabled"],de={class:"modal-footer"},re={class:"modal modal-sm"},ue={class:"modal-footer"},ce=["disabled"],pe={key:0,class:"btn-loading"},ve={class:"modal modal-lg"},me={class:"modal-header"},fe={class:"modal-body"},ge={class:"form-row"},ye={class:"form-group"},_e={class:"form-group"},be={class:"form-row"},ke={class:"form-group"},we={class:"form-group"},xe={class:"form-row"},he={class:"form-group"},Ce={class:"form-group"},Ve={class:"form-row"},Ke={class:"form-group"},ze={class:"form-group"},Be={class:"form-row"},Se={class:"form-group"},$e={class:"form-group"},Ie={class:"modal-footer"},Me=["disabled"],Ae={key:0,class:"btn-loading"},De={key:0,class:"modal-overlay"},Pe={class:"modal modal-sm"},Le={class:"modal-body"},Te={class:"key-display"},Ue={class:"key-value"},qe={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Fe={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ne={__name:"APIKeys",setup(Ee){const k=u(!1),T=u([]),r=q({page:1,pageSize:20,total:0}),w=u(!1),x=u(!1),y=u(null),z=u([]),d=q({page:1,pageSize:20,total:0}),h=u(!1),B=u(null),C=u(!1),_=u(!1),V=u(!1),s=q({name:"",description:"",allowed_platforms:"",allowed_models:"",blocked_models:"",allowed_clients:"",rate_limit:0,daily_limit:0,monthly_quota:0,expires_at:""}),U=u(!1),S=u(""),$=u(!1);function N(o){return o?new Date(o).toLocaleString("zh-CN"):"-"}function b(o){return o?o.toLocaleString():"0"}function Q(o){return!o||o<=0?"不限":`${o}/分`}function E(o){return o.expires_at?new Date(o.expires_at)<new Date:!1}function W(o){return o.status==="disabled"?"禁用":E(o)?"已过期":"正常"}function X(o){return o.status==="disabled"?"badge-danger":E(o)?"badge-warning":"badge-success"}async function g(){var o,e;k.value=!0;try{const v=await K.adminGetAllAPIKeys({page:r.page,page_size:r.pageSize});T.value=((o=v.data)==null?void 0:o.items)||[],r.total=((e=v.data)==null?void 0:e.total)||0}catch{f.error("获取 API Key 列表失败")}finally{k.value=!1}}async function Y(o){try{await K.adminToggleAPIKey(o.id),f.success("状态已更新"),g()}catch{f.error("操作失败")}}function Z(o){B.value=o,h.value=!0}async function tt(){if(B.value){C.value=!0;try{await K.adminDeleteAPIKey(B.value.id),f.success("删除成功"),h.value=!1,B.value=null,g()}catch{f.error("删除失败")}finally{C.value=!1}}}function et(o){y.value=o,d.page=1,w.value=!0,I()}async function I(){var o,e;if(y.value){x.value=!0,z.value=[];try{const v=await K.adminGetAPIKeyLogs(y.value.id,{page:d.page,page_size:d.pageSize});z.value=((o=v.data)==null?void 0:o.items)||[],d.total=((e=v.data)==null?void 0:e.total)||0}catch{f.error("获取日志失败")}finally{x.value=!1}}}function lt(){s.name="",s.description="",s.allowed_platforms="",s.allowed_models="",s.blocked_models="",s.allowed_clients="",s.rate_limit=0,s.daily_limit=0,s.monthly_quota=0,s.expires_at="",_.value=!0}async function H(){if(!s.name){f.error("请输入 API Key 名称");return}V.value=!0;try{const o={name:s.name,description:s.description,allowed_platforms:s.allowed_platforms,allowed_models:s.allowed_models,blocked_models:s.blocked_models,allowed_clients:s.allowed_clients,rate_limit:s.rate_limit||0,daily_limit:s.daily_limit||0,monthly_quota:s.monthly_quota||0};s.expires_at&&(o.expires_at=new Date(s.expires_at).toISOString());const e=await K.adminCreateAPIKey(o);_.value=!1,S.value=e.data.key,$.value=!1,U.value=!0,g()}catch{f.error("创建失败")}finally{V.value=!1}}async function st(){try{await navigator.clipboard.writeText(S.value),$.value=!0,f.success("已复制到剪贴板")}catch{f.error("复制失败")}}function ot(){U.value=!1,S.value=""}return nt(()=>{g()}),(o,e)=>{var v,G,O;return n(),i("div",dt,[t("div",{class:"page-header"},[e[26]||(e[26]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"API Key 管理"),t("p",{class:"page-subtitle"},"查看和管理所有 API Key")],-1)),t("div",{class:"header-actions"},[t("button",{class:"btn btn-primary",onClick:lt},[...e[24]||(e[24]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),D(" 创建 Key ",-1)])]),t("button",{class:"btn btn-outline",onClick:g},[...e[25]||(e[25]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"23,4 23,10 17,10"}),t("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"})],-1),D(" 刷新 ",-1)])])])]),t("div",rt,[t("div",ut,[t("table",ct,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",{class:"col-id"},"ID"),t("th",{class:"col-name"},"名称"),t("th",{class:"col-prefix"},"Key 前缀"),t("th",{class:"col-status"},"状态"),t("th",{class:"col-rate"},"限速"),t("th",{class:"col-requests"},"请求数"),t("th",{class:"col-cost"},"费用"),t("th",{class:"col-time"},"创建时间"),t("th",{class:"col-actions"},"操作")])],-1)),k.value?c("",!0):(n(),i("tbody",pt,[(n(!0),i(R,null,j(T.value,l=>(n(),i("tr",{key:l.id},[t("td",vt,a(l.id),1),t("td",mt,[t("span",ft,a(l.name),1)]),t("td",gt,[t("code",yt,a(l.key_prefix)+"...",1)]),t("td",_t,[t("span",{class:F(["badge",X(l)])},a(W(l)),3)]),t("td",bt,[t("span",kt,a(Q(l.rate_limit)),1)]),t("td",wt,a(b(l.request_count)),1),t("td",xt,[t("span",ht,"$"+a((l.cost_used||0).toFixed(4)),1)]),t("td",Ct,a(N(l.created_at)),1),t("td",Vt,[t("div",Kt,[t("button",{class:"action-btn",onClick:M=>et(l),title:"日志"},[...e[27]||(e[27]=[it('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-020a9aaa><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" data-v-020a9aaa></path><polyline points="14,2 14,8 20,8" data-v-020a9aaa></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-020a9aaa></line><line x1="16" y1="17" x2="8" y2="17" data-v-020a9aaa></line></svg>',1)])],8,zt),t("button",{class:F(["action-btn",l.status==="active"?"warning":"success"]),onClick:M=>Y(l),title:l.status==="active"?"禁用":"启用"},[l.status==="active"?(n(),i("svg",St,[...e[28]||(e[28]=[t("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"},null,-1),t("path",{d:"M7 11V7a5 5 0 0110 0v4"},null,-1)])])):(n(),i("svg",$t,[...e[29]||(e[29]=[t("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"},null,-1),t("path",{d:"M7 11V7a5 5 0 019.9-1"},null,-1)])]))],10,Bt),t("button",{class:"action-btn danger",onClick:M=>Z(l),title:"删除"},[...e[30]||(e[30]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"3,6 5,6 21,6"}),t("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,It)])])]))),128))]))]),k.value?(n(),i("div",Mt,[...e[32]||(e[32]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):c("",!0),!k.value&&T.value.length===0?(n(),i("div",At,[...e[33]||(e[33]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"})],-1),t("span",null,"暂无 API Key",-1)])])):c("",!0)]),r.total>0?(n(),i("div",Dt,[t("div",Pt," 共 "+a(r.total)+" 条记录 ",1),t("div",Lt,[p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.pageSize=l),onChange:g,class:"page-size-select"},[...e[34]||(e[34]=[t("option",{value:10},"10 条/页",-1),t("option",{value:20},"20 条/页",-1),t("option",{value:50},"50 条/页",-1)])],544),[[J,r.pageSize]]),t("div",Tt,[t("button",{class:"page-btn",disabled:r.page<=1,onClick:e[1]||(e[1]=l=>{r.page--,g()})},[...e[35]||(e[35]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,Ut),t("span",qt,a(r.page)+" / "+a(Math.ceil(r.total/r.pageSize)||1),1),t("button",{class:"page-btn",disabled:r.page>=Math.ceil(r.total/r.pageSize),onClick:e[2]||(e[2]=l=>{r.page++,g()})},[...e[36]||(e[36]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,Ft)])])])):c("",!0)]),(n(),A(L,{to:"body"},[w.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:e[8]||(e[8]=P(l=>w.value=!1,["self"]))},[t("div",Nt,[t("div",Et,[t("div",Ht,[t("h2",null,a((v=y.value)==null?void 0:v.key_prefix)+" 使用日志",1),t("div",Gt,[t("span",Ot,"请求数: "+a(((G=y.value)==null?void 0:G.request_count)||0),1),t("span",Rt,"费用: $"+a((((O=y.value)==null?void 0:O.cost_used)||0).toFixed(4)),1)])]),t("button",{class:"modal-close",onClick:e[3]||(e[3]=l=>w.value=!1)},[...e[37]||(e[37]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",jt,[t("div",Jt,[t("table",Qt,[e[38]||(e[38]=t("thead",null,[t("tr",null,[t("th",null,"时间"),t("th",null,"模型"),t("th",null,"输入 Token"),t("th",null,"输出 Token"),t("th",null,"缓存创建"),t("th",null,"缓存读取"),t("th",null,"总 Token"),t("th",null,"费用")])],-1)),x.value?c("",!0):(n(),i("tbody",Wt,[(n(!0),i(R,null,j(z.value,(l,M)=>(n(),i("tr",{key:M},[t("td",null,a(N(l.timestamp)),1),t("td",null,[t("code",Xt,a(l.model),1)]),t("td",null,a(b(l.input_tokens||0)),1),t("td",null,a(b(l.output_tokens||0)),1),t("td",null,a(b(l.cache_creation_input_tokens||0)),1),t("td",null,a(b(l.cache_read_input_tokens||0)),1),t("td",null,a(b(l.total_tokens||0)),1),t("td",Yt,"$"+a((l.total_cost||0).toFixed(6)),1)]))),128))]))]),x.value?(n(),i("div",Zt,[...e[39]||(e[39]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):c("",!0),!x.value&&z.value.length===0?(n(),i("div",te,[...e[40]||(e[40]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),t("polyline",{points:"14,2 14,8 20,8"})],-1),t("span",null,"暂无日志",-1)])])):c("",!0)]),d.total>0?(n(),i("div",ee,[t("div",le," 共 "+a(d.total)+" 条记录 ",1),t("div",se,[p(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>d.pageSize=l),onChange:I,class:"page-size-select"},[...e[41]||(e[41]=[t("option",{value:20},"20 条/页",-1),t("option",{value:50},"50 条/页",-1),t("option",{value:100},"100 条/页",-1)])],544),[[J,d.pageSize]]),t("div",oe,[t("button",{class:"page-btn",disabled:d.page<=1,onClick:e[5]||(e[5]=l=>{d.page--,I()})},[...e[42]||(e[42]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,ae),t("span",ne,a(d.page)+" / "+a(Math.ceil(d.total/d.pageSize)||1),1),t("button",{class:"page-btn",disabled:d.page>=Math.ceil(d.total/d.pageSize),onClick:e[6]||(e[6]=l=>{d.page++,I()})},[...e[43]||(e[43]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,ie)])])])):c("",!0)]),t("div",de,[t("button",{class:"btn btn-secondary",onClick:e[7]||(e[7]=l=>w.value=!1)},"关闭")])])])):c("",!0)])),(n(),A(L,{to:"body"},[h.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:e[10]||(e[10]=P(l=>h.value=!1,["self"]))},[t("div",re,[e[44]||(e[44]=t("div",{class:"modal-header danger"},[t("div",{class:"danger-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})])]),t("h2",null,"确认删除")],-1)),e[45]||(e[45]=t("div",{class:"modal-body"},[t("p",{class:"delete-message"},"确定要删除此 API Key 吗？此操作不可撤销。")],-1)),t("div",ue,[t("button",{class:"btn btn-secondary",onClick:e[9]||(e[9]=l=>h.value=!1)},"取消"),t("button",{class:"btn btn-danger",disabled:C.value,onClick:tt},[C.value?(n(),i("span",pe)):c("",!0),D(" "+a(C.value?"删除中...":"删除"),1)],8,ce)])])])):c("",!0)])),(n(),A(L,{to:"body"},[_.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:e[23]||(e[23]=P(l=>_.value=!1,["self"]))},[t("div",ve,[t("div",me,[e[47]||(e[47]=t("h2",null,"创建 API Key",-1)),t("button",{class:"modal-close",onClick:e[11]||(e[11]=l=>_.value=!1)},[...e[46]||(e[46]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",fe,[t("form",{class:"create-form",onSubmit:P(H,["prevent"])},[t("div",ge,[t("div",ye,[e[48]||(e[48]=t("label",{class:"form-label required"},"名称",-1)),p(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>s.name=l),type:"text",class:"form-input",placeholder:"API Key 名称"},null,512),[[m,s.name]])]),t("div",_e,[e[49]||(e[49]=t("label",{class:"form-label"},"描述",-1)),p(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>s.description=l),type:"text",class:"form-input",placeholder:"可选描述"},null,512),[[m,s.description]])])]),t("div",be,[t("div",ke,[e[50]||(e[50]=t("label",{class:"form-label"},"允许平台",-1)),p(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>s.allowed_platforms=l),type:"text",class:"form-input",placeholder:"留空允许全部，多个用逗号分隔"},null,512),[[m,s.allowed_platforms]]),e[51]||(e[51]=t("span",{class:"form-hint"},"可选: claude, openai, gemini, bedrock, azure",-1))]),t("div",we,[e[52]||(e[52]=t("label",{class:"form-label"},"允许客户端",-1)),p(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>s.allowed_clients=l),type:"text",class:"form-input",placeholder:"留空允许全部，多个用逗号分隔"},null,512),[[m,s.allowed_clients]])])]),t("div",xe,[t("div",he,[e[53]||(e[53]=t("label",{class:"form-label"},"允许模型",-1)),p(t("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>s.allowed_models=l),type:"text",class:"form-input",placeholder:"留空允许全部"},null,512),[[m,s.allowed_models]])]),t("div",Ce,[e[54]||(e[54]=t("label",{class:"form-label"},"禁用模型",-1)),p(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>s.blocked_models=l),type:"text",class:"form-input",placeholder:"禁止使用的模型"},null,512),[[m,s.blocked_models]])])]),t("div",Ve,[t("div",Ke,[e[55]||(e[55]=t("label",{class:"form-label"},"限速 (次/分钟)",-1)),p(t("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>s.rate_limit=l),type:"number",class:"form-input",placeholder:"0 表示不限制"},null,512),[[m,s.rate_limit,void 0,{number:!0}]])]),t("div",ze,[e[56]||(e[56]=t("label",{class:"form-label"},"每日限额 (次)",-1)),p(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>s.daily_limit=l),type:"number",class:"form-input",placeholder:"0 表示不限制"},null,512),[[m,s.daily_limit,void 0,{number:!0}]])])]),t("div",Be,[t("div",Se,[e[57]||(e[57]=t("label",{class:"form-label"},"月度配额 ($)",-1)),p(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>s.monthly_quota=l),type:"number",step:"0.01",class:"form-input",placeholder:"0 表示不限制"},null,512),[[m,s.monthly_quota,void 0,{number:!0}]])]),t("div",$e,[e[58]||(e[58]=t("label",{class:"form-label"},"过期时间",-1)),p(t("input",{"onUpdate:modelValue":e[21]||(e[21]=l=>s.expires_at=l),type:"datetime-local",class:"form-input"},null,512),[[m,s.expires_at]])])])],32)]),t("div",Ie,[t("button",{class:"btn btn-secondary",onClick:e[22]||(e[22]=l=>_.value=!1)},"取消"),t("button",{class:"btn btn-primary",disabled:V.value||!s.name,onClick:H},[V.value?(n(),i("span",Ae)):c("",!0),D(" "+a(V.value?"创建中...":"创建"),1)],8,Me)])])])):c("",!0)])),(n(),A(L,{to:"body"},[U.value?(n(),i("div",De,[t("div",Pe,[e[62]||(e[62]=t("div",{class:"modal-header success"},[t("div",{class:"success-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),t("polyline",{points:"22,4 12,14.01 9,11.01"})])]),t("h2",null,"创建成功")],-1)),t("div",Le,[e[61]||(e[61]=t("p",{class:"key-warning"},"请立即复制并妥善保存此 Key，关闭后将无法再次查看完整 Key！",-1)),t("div",Te,[t("code",Ue,a(S.value),1),t("button",{class:F(["copy-btn",{copied:$.value}]),onClick:st},[$.value?(n(),i("svg",Fe,[...e[60]||(e[60]=[t("polyline",{points:"20,6 9,17 4,12"},null,-1)])])):(n(),i("svg",qe,[...e[59]||(e[59]=[t("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"},null,-1),t("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"},null,-1)])]))],2)])]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-primary",onClick:ot},"我已复制，关闭")])])])):c("",!0)]))])}}},Ge=at(Ne,[["__scopeId","data-v-020a9aaa"]]);export{Ge as default};
