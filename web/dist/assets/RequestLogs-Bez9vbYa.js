import{_ as I,r as d,a as U,q as P,o as E,c as o,b as t,p as K,s as b,t as l,d as j,f as p,P as T,e as c,F as M,x as B,v as V,L,l as F,n}from"./index-CQyKkE5B.js";const J={class:"request-logs-page"},O={class:"page-header"},Q=["disabled"],W={class:"stats-grid"},X={class:"stat-card"},Y={class:"stat-content"},Z={class:"stat-value"},tt={class:"stat-card"},st={class:"stat-content"},et={class:"stat-value"},lt={class:"stat-card"},at={class:"stat-content"},ot={class:"stat-value"},nt={class:"stat-card"},it={class:"stat-content"},dt={class:"stat-value"},ct={class:"tabs-container"},rt={class:"tabs-header"},ut={class:"tab-content"},vt={class:"table-card"},_t={class:"table-container"},pt={class:"data-table"},gt={key:0},ht={class:"col-right"},bt={class:"col-right"},ft={class:"col-right cost-cell"},yt={key:0,class:"loading-state"},mt={key:1,class:"empty-state"},kt={class:"tab-content"},xt={class:"table-card"},Ct={class:"table-container"},St={class:"data-table"},qt={key:0},Mt={class:"model-code"},Bt={class:"col-right"},Ft={class:"col-right"},zt={class:"col-right cost-cell"},Tt={key:0,class:"loading-state"},$t={key:1,class:"empty-state"},Rt={class:"tab-content"},Ut={class:"filter-bar"},Vt={class:"filter-group"},Lt={class:"date-inputs"},wt={class:"filter-group"},Dt=["value"],Nt={class:"table-card"},Gt={class:"table-container"},At={class:"data-table"},Ht={key:0},It={class:"model-code"},Pt={class:"ip-text"},Et={class:"col-right"},Kt={class:"col-right"},jt={class:"col-right"},Jt={class:"col-right"},Ot={class:"col-right"},Qt={class:"col-right cost-cell"},Wt={class:"time-text"},Xt={key:0,class:"loading-state"},Yt={key:1,class:"empty-state"},Zt={key:0,class:"table-footer"},ts={class:"pagination-info"},ss={class:"pagination-controls"},es={class:"page-btns"},ls=["disabled"],as={class:"page-current"},os=["disabled"],ns={__name:"RequestLogs",setup(is){const r=d("daily"),f=d(""),y=d(""),m=d(""),g=U({total_requests:0,total_tokens:0,total_cost:0}),z=d([]),_=d(!1),k=d([]),x=d(!1),q=d([]),C=d(!1),i=U({page:1,pageSize:20,total:0}),w=P(()=>k.value.map(a=>a.model).filter(Boolean));function u(a){return a?a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a:"0"}function D(a){return a?new Date(a).toLocaleString("zh-CN"):""}async function $(){var a,s,e,v,R;_.value=!0,x.value=!0;try{const S=await F.adminGetUsageSummary(),A=await F.adminGetDailyUsage({}),H=await F.adminGetModelUsage({});g.total_requests=((a=S.data)==null?void 0:a.total_requests)||0,g.total_tokens=((s=S.data)==null?void 0:s.total_tokens)||0,g.total_cost=((e=S.data)==null?void 0:e.total_cost)||0,z.value=((v=A.data)==null?void 0:v.daily)||[],k.value=((R=H.data)==null?void 0:R.models)||[]}catch(S){console.error("Failed to fetch summary:",S)}finally{_.value=!1,x.value=!1}}async function h(){C.value=!0;try{const a={page:i.page,page_size:i.pageSize};f.value&&y.value&&(a.start_date=f.value,a.end_date=y.value),m.value&&(a.model=m.value);const e=(await F.adminGetUsageRecords(a)).data||{};q.value=e.items||[],i.total=e.total||q.value.length}catch(a){console.error("Failed to fetch records:",a)}finally{C.value=!1}}function N(){f.value="",y.value="",m.value="",i.page=1,h()}function G(){$(),h()}return E(()=>{$()}),(a,s)=>(n(),o("div",J,[t("div",O,[s[11]||(s[11]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"请求日志"),t("p",{class:"page-subtitle"},"查看 API 请求统计和详细记录")],-1)),t("button",{class:"btn btn-outline",onClick:G,disabled:_.value},[(n(),o("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:b({spinning:_.value})},[...s[9]||(s[9]=[t("polyline",{points:"23,4 23,10 17,10"},null,-1),t("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"},null,-1)])],2)),s[10]||(s[10]=K(" 刷新 ",-1))],8,Q)]),t("div",W,[t("div",X,[s[13]||(s[13]=t("div",{class:"stat-icon requests"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})])],-1)),t("div",Y,[t("span",Z,l(g.total_requests||0),1),s[12]||(s[12]=t("span",{class:"stat-label"},"总请求数",-1))])]),t("div",tt,[s[15]||(s[15]=t("div",{class:"stat-icon tokens"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polygon",{points:"16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88"})])],-1)),t("div",st,[t("span",et,l(u(g.total_tokens)),1),s[14]||(s[14]=t("span",{class:"stat-label"},"总 Token",-1))])]),t("div",lt,[s[17]||(s[17]=t("div",{class:"stat-icon cost"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),t("path",{d:"M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"})])],-1)),t("div",at,[t("span",ot,"$"+l((g.total_cost||0).toFixed(4)),1),s[16]||(s[16]=t("span",{class:"stat-label"},"总费用",-1))])]),t("div",nt,[s[19]||(s[19]=j('<div class="stat-icon models" data-v-372615f8><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-372615f8><rect x="3" y="3" width="7" height="7" data-v-372615f8></rect><rect x="14" y="3" width="7" height="7" data-v-372615f8></rect><rect x="14" y="14" width="7" height="7" data-v-372615f8></rect><rect x="3" y="14" width="7" height="7" data-v-372615f8></rect></svg></div>',1)),t("div",it,[t("span",dt,l(k.value.length),1),s[18]||(s[18]=t("span",{class:"stat-label"},"模型数",-1))])])]),t("div",ct,[t("div",rt,[t("button",{class:b(["tab-btn",{active:r.value==="daily"}]),onClick:s[0]||(s[0]=e=>r.value="daily")},"每日汇总",2),t("button",{class:b(["tab-btn",{active:r.value==="models"}]),onClick:s[1]||(s[1]=e=>r.value="models")},"模型统计",2),t("button",{class:b(["tab-btn",{active:r.value==="records"}]),onClick:s[2]||(s[2]=e=>r.value="records")},"详细记录",2)]),p(t("div",ut,[t("div",vt,[t("div",_t,[t("table",pt,[s[20]||(s[20]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",{class:"col-right"},"请求数"),t("th",{class:"col-right"},"Token"),t("th",{class:"col-right"},"费用")])],-1)),_.value?c("",!0):(n(),o("tbody",gt,[(n(!0),o(M,null,B(z.value,e=>{var v;return n(),o("tr",{key:e.date},[t("td",null,l(e.date),1),t("td",ht,l(e.request_count),1),t("td",bt,l(u(e.total_tokens)),1),t("td",ft,"$"+l(((v=e.total_cost)==null?void 0:v.toFixed(4))||"0"),1)])}),128))]))]),_.value?(n(),o("div",yt,[...s[21]||(s[21]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):c("",!0),!_.value&&z.value.length===0?(n(),o("div",mt,[...s[22]||(s[22]=[t("span",null,"暂无数据",-1)])])):c("",!0)])])],512),[[T,r.value==="daily"]]),p(t("div",kt,[t("div",xt,[t("div",Ct,[t("table",St,[s[23]||(s[23]=t("thead",null,[t("tr",null,[t("th",null,"模型"),t("th",{class:"col-right"},"请求数"),t("th",{class:"col-right"},"Token"),t("th",{class:"col-right"},"费用")])],-1)),x.value?c("",!0):(n(),o("tbody",qt,[(n(!0),o(M,null,B(k.value,e=>{var v;return n(),o("tr",{key:e.model},[t("td",null,[t("code",Mt,l(e.model),1)]),t("td",Bt,l(e.request_count),1),t("td",Ft,l(u(e.total_tokens)),1),t("td",zt,"$"+l(((v=e.total_cost)==null?void 0:v.toFixed(4))||"0"),1)])}),128))]))]),x.value?(n(),o("div",Tt,[...s[24]||(s[24]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):c("",!0),!x.value&&k.value.length===0?(n(),o("div",$t,[...s[25]||(s[25]=[t("span",null,"暂无数据",-1)])])):c("",!0)])])],512),[[T,r.value==="models"]]),p(t("div",Rt,[t("div",Ut,[t("div",Vt,[s[27]||(s[27]=t("label",{class:"filter-label"},"时间范围",-1)),t("div",Lt,[p(t("input",{type:"date","onUpdate:modelValue":s[3]||(s[3]=e=>f.value=e),class:"date-input"},null,512),[[V,f.value]]),s[26]||(s[26]=t("span",{class:"date-sep"},"至",-1)),p(t("input",{type:"date","onUpdate:modelValue":s[4]||(s[4]=e=>y.value=e),class:"date-input"},null,512),[[V,y.value]])])]),t("div",wt,[s[29]||(s[29]=t("label",{class:"filter-label"},"模型",-1)),p(t("select",{"onUpdate:modelValue":s[5]||(s[5]=e=>m.value=e),class:"filter-select"},[s[28]||(s[28]=t("option",{value:""},"全部模型",-1)),(n(!0),o(M,null,B(w.value,e=>(n(),o("option",{key:e,value:e},l(e),9,Dt))),128))],512),[[L,m.value]])]),t("div",{class:"filter-actions"},[t("button",{class:"btn btn-primary btn-sm",onClick:h},"查询"),t("button",{class:"btn btn-secondary btn-sm",onClick:N},"重置")])]),t("div",Nt,[t("div",Gt,[t("table",At,[s[30]||(s[30]=t("thead",null,[t("tr",null,[t("th",null,"模型"),t("th",null,"请求IP"),t("th",{class:"col-right"},"输入"),t("th",{class:"col-right"},"输出"),t("th",{class:"col-right"},"缓存创建"),t("th",{class:"col-right"},"缓存读取"),t("th",{class:"col-right"},"总Token"),t("th",{class:"col-right"},"费用"),t("th",null,"时间")])],-1)),C.value?c("",!0):(n(),o("tbody",Ht,[(n(!0),o(M,null,B(q.value,e=>(n(),o("tr",{key:e.id},[t("td",null,[t("code",It,l(e.model),1)]),t("td",null,[t("span",Pt,l(e.request_ip),1)]),t("td",Et,l(u(e.input_tokens)),1),t("td",Kt,l(u(e.output_tokens)),1),t("td",jt,[t("span",{class:b({"cache-highlight":e.cache_creation_input_tokens>0})},l(u(e.cache_creation_input_tokens)),3)]),t("td",Jt,[t("span",{class:b({"cache-read-highlight":e.cache_read_input_tokens>0})},l(u(e.cache_read_input_tokens)),3)]),t("td",Ot,l(u(e.total_tokens)),1),t("td",Qt,"$"+l((e.total_cost||0).toFixed(4)),1),t("td",null,[t("span",Wt,l(D(e.timestamp||e.request_time)),1)])]))),128))]))]),C.value?(n(),o("div",Xt,[...s[31]||(s[31]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):c("",!0),!C.value&&q.value.length===0?(n(),o("div",Yt,[...s[32]||(s[32]=[t("span",null,"暂无记录",-1)])])):c("",!0)]),i.total>0?(n(),o("div",Zt,[t("div",ts,"共 "+l(i.total)+" 条",1),t("div",ss,[p(t("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>i.pageSize=e),onChange:h,class:"page-size-select"},[...s[33]||(s[33]=[t("option",{value:20},"20 条/页",-1),t("option",{value:50},"50 条/页",-1),t("option",{value:100},"100 条/页",-1)])],544),[[L,i.pageSize]]),t("div",es,[t("button",{class:"page-btn",disabled:i.page<=1,onClick:s[7]||(s[7]=e=>{i.page--,h()})},[...s[34]||(s[34]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,ls),t("span",as,l(i.page)+" / "+l(Math.ceil(i.total/i.pageSize)||1),1),t("button",{class:"page-btn",disabled:i.page>=Math.ceil(i.total/i.pageSize),onClick:s[8]||(s[8]=e=>{i.page++,h()})},[...s[35]||(s[35]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,os)])])])):c("",!0)])],512),[[T,r.value==="records"]])])]))}},cs=I(ns,[["__scopeId","data-v-372615f8"]]);export{cs as default};
