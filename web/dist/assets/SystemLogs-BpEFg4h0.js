import{_ as ge,r as u,o as ke,c as n,b as e,z as ye,p as $,s as k,t as a,f as w,e as d,L as Z,F as N,x as H,v as ee,h as he,M as se,w as O,T as me,l as E,Q as le,E as R,n as o}from"./index-CQyKkE5B.js";const be={class:"system-logs-page"},Ce={class:"page-header"},xe=["disabled"],we={class:"source-tabs"},Se={class:"logs-layout"},ze={class:"file-panel"},Be={class:"panel-header"},Le={class:"panel-title"},Fe={class:"file-count"},Ve={class:"filter-bar"},Me=["value"],Te={key:0,class:"file-list"},$e=["onClick"],Ne={class:"file-info"},Ee={class:"file-name"},Re={class:"file-meta"},De={class:"file-size"},Ue={class:"file-actions"},He=["onClick"],Oe=["onClick"],je=["onClick"],Ae={key:0,class:"empty-files"},Ie={key:1,class:"loading-files"},Pe={class:"content-panel"},Ke={class:"panel-header"},Ge={key:0,class:"content-info"},We={class:"selected-file"},Je={key:0,class:"info-badge"},Qe={key:1,class:"info-badge success"},qe={key:1,class:"no-file"},Xe={key:2,class:"content-tools"},Ye={class:"search-box small"},Ze={class:"checkbox-label"},es={class:"checkbox-label"},ss=["disabled"],ls=["disabled"],ts={key:0,class:"empty-content"},os={key:1,class:"empty-content"},ns=["onClick"],as={class:"log-main-line"},is={class:"log-time"},us={key:0,class:"log-module"},ds={class:"log-message"},rs={key:1,class:"inline-fields"},vs={key:0,class:"inline-field user"},cs={key:1,class:"inline-field model"},ps={key:3,class:"inline-field latency"},fs={key:2,class:"expand-icon"},_s={key:0,class:"log-fields"},gs={class:"fields-grid"},ks={class:"field-key"},ys={class:"field-value"},hs={key:0,class:"log-field full"},ms={class:"field-value caller"},bs={key:1,class:"log-raw"},Cs={key:4,class:"loading-overlay"},xs={key:0,class:"content-footer"},ws={class:"pagination-info"},Ss={class:"pagination-controls"},zs={class:"page-btns"},Bs=["disabled"],Ls={class:"page-current"},Fs=["disabled"],Vs={class:"modal modal-sm"},Ms={class:"modal-body"},Ts={class:"delete-message"},$s={class:"modal-footer"},Ns=["disabled"],Es={key:0,class:"btn-loading"},Rs={__name:"SystemLogs",setup(Ds){const v=u("app"),S=u([]),j=u([]),z=u(!1),B=u(""),L=u(""),c=u(""),y=u([]),h=u([]),p=u({}),C=u(!1),F=u(!1),f=u(1),A=u(200),V=u(""),D=u(!1),m=u(null),_=u([]),I=u(!0),M=u(!1),U=u(""),T=u(!1);function G(){S.value=[],j.value=[],c.value="",y.value=[],h.value=[],p.value={},B.value="",L.value="",f.value=1,V.value="",D.value=!1,_.value=[],x()}async function x(){var t,s;z.value=!0;try{const l={source:v.value};B.value&&(l.category=B.value),L.value&&v.value==="app"&&(l.date=L.value);const i=await E.getSystemLogFiles(l);S.value=((t=i.data)==null?void 0:t.files)||[],j.value=((s=i.data)==null?void 0:s.categories)||[]}catch(l){console.error("Failed to load files:",l)}finally{z.value=!1}}function te(t){c.value=t.name,f.value=1,V.value="",_.value=[],b()}async function b(){var t,s,l,i,g;if(c.value){C.value=!0,_.value=[];try{const r=await E.readSystemLog({file:c.value,source:v.value,page:f.value,page_size:A.value,keyword:V.value,reverse:D.value?"true":""});y.value=((t=r.data)==null?void 0:t.lines)||[],h.value=((s=r.data)==null?void 0:s.entries)||[],p.value={size_human:(l=r.data)==null?void 0:l.size_human,total_lines:(i=r.data)==null?void 0:i.total_lines,total_pages:(g=r.data)==null?void 0:g.total_pages},le(()=>{m.value&&(m.value.scrollTop=0)})}catch{R.error("Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•")}finally{C.value=!1}}}async function W(){var t,s,l,i,g;if(c.value){F.value=!0,_.value=[];try{const r=await E.tailSystemLog({file:c.value,source:v.value,lines:200});y.value=((t=r.data)==null?void 0:t.lines)||[],h.value=((s=r.data)==null?void 0:s.entries)||[],p.value={size_human:(l=r.data)==null?void 0:l.size_human,total_lines:(i=r.data)==null?void 0:i.count,total_pages:1},f.value=1,le(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)}),R.success("Â∑≤Âä†ËΩΩÊúÄÊñ∞ "+(((g=r.data)==null?void 0:g.count)||0)+" Ë°å")}catch{R.error("Âä†ËΩΩÂÆûÊó∂Êó•ÂøóÂ§±Ë¥•")}finally{F.value=!1}}}function oe(){f.value=1,b()}function ne(t){c.value=t.name,W()}function ae(t){window.open(E.downloadSystemLog(t.name,v.value),"_blank")}function ie(t){U.value=t.name,M.value=!0}async function ue(){T.value=!0;try{await E.deleteSystemLog(U.value,v.value),R.success("Âà†Èô§ÊàêÂäü"),c.value===U.value&&(c.value="",y.value=[],h.value=[],p.value={}),M.value=!1,x()}catch{R.error("Âà†Èô§Â§±Ë¥•")}finally{T.value=!1}}function J(t){if(!t)return"";const s=t.toUpperCase();return s==="ERROR"||s==="FATAL"?"level-error":s==="WARN"||s==="WARNING"?"level-warn":s==="DEBUG"?"level-debug":"level-info"}function de(t){if(!t)return"";try{return new Date(t).toLocaleString("zh-CN",{hour12:!1})}catch{return t}}function Q(t){return t.fields&&Object.keys(t.fields).length>0||t.caller}function re(t){return t.fields?["user_id","model","status","latency"].some(s=>t.fields[s]!==void 0):!1}function P(t){return I.value?!_.value.includes(t):_.value.includes(t)}function ve(t){const s=_.value.indexOf(t);s>-1?_.value.splice(s,1):_.value.push(t)}function ce(t){return t>=500?"status-error":t>=400?"status-warn":t>=200&&t<300?"status-success":""}function pe(t){return t===void 0?"":t>=1e3?(t/1e3).toFixed(2)+"s":t+"ms"}function fe(t){if(!t)return{};const s=["user_id","api_key_id","account_id","model","client_ip","method","path","status","latency","input_tokens","output_tokens","total_tokens","total_cost","error"],l={};for(const i of s)t[i]!==void 0&&(l[i]=t[i]);for(const i of Object.keys(t))l[i]===void 0&&(l[i]=t[i]);return l}function _e(t,s){return s==null?"-":["input_cost","output_cost","total_cost"].includes(t)?"$"+Number(s).toFixed(6):["latency","exec_duration"].includes(t)?typeof s=="number"?s>=1e3?(s/1e3).toFixed(2)+"s":s+"ms":s:["input_tokens","output_tokens","total_tokens"].includes(t)?Number(s).toLocaleString():typeof s=="object"?JSON.stringify(s):String(s)}return ke(()=>{x()}),(t,s)=>(o(),n("div",be,[e("div",Ce,[s[14]||(s[14]=e("div",{class:"header-content"},[e("h1",{class:"page-title"},"Á≥ªÁªüÊó•Âøó"),e("p",{class:"page-subtitle"},"Êü•ÁúãÂ∫îÁî®Êó•ÂøóÂíåÊúçÂä°Âô®Êó•Âøó")],-1)),e("button",{class:"btn btn-outline",onClick:x,disabled:z.value},[(o(),n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:k({spinning:z.value})},[...s[12]||(s[12]=[e("polyline",{points:"23,4 23,10 17,10"},null,-1),e("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"},null,-1)])],2)),s[13]||(s[13]=$(" Âà∑Êñ∞ ",-1))],8,xe)]),e("div",we,[e("button",{class:k(["source-tab",{active:v.value==="app"}]),onClick:s[0]||(s[0]=l=>{v.value="app",G()})},[...s[15]||(s[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e("polyline",{points:"14,2 14,8 20,8"})],-1),$(" Â∫îÁî®Êó•Âøó ",-1)])],2),e("button",{class:k(["source-tab",{active:v.value==="server"}]),onClick:s[1]||(s[1]=l=>{v.value="server",G()})},[...s[16]||(s[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e("line",{x1:"12",y1:"17",x2:"12",y2:"21"})],-1),$(" ÊúçÂä°Âô®Êó•Âøó ",-1)])],2)]),e("div",Se,[e("div",ze,[e("div",Be,[e("span",Le,a(v.value==="app"?"Â∫îÁî®Êó•ÂøóÊñá‰ª∂":"ÊúçÂä°Âô®Êó•ÂøóÊñá‰ª∂"),1),e("span",Fe,a(S.value.length)+" ‰∏™",1)]),e("div",Ve,[w(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>B.value=l),onChange:x,class:"filter-select"},[s[17]||(s[17]=e("option",{value:""},"ÂÖ®ÈÉ®ÂàÜÁ±ª",-1)),(o(!0),n(N,null,H(j.value,l=>(o(),n("option",{key:l.name,value:l.name},a(l.label)+" ("+a(l.count)+")",9,Me))),128))],544),[[Z,B.value]]),v.value==="app"?w((o(),n("input",{key:0,type:"date","onUpdate:modelValue":s[3]||(s[3]=l=>L.value=l),onChange:x,class:"filter-date"},null,544)),[[ee,L.value]]):d("",!0)]),z.value?(o(),n("div",Ie,[...s[22]||(s[22]=[e("div",{class:"loading-spinner small"},null,-1),e("span",null,"Âä†ËΩΩ‰∏≠...",-1)])])):(o(),n("div",Te,[(o(!0),n(N,null,H(S.value,l=>(o(),n("div",{key:l.name,class:k(["file-item",{selected:c.value===l.name}]),onClick:i=>te(l)},[e("div",Ne,[s[18]||(s[18]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e("polyline",{points:"14,2 14,8 20,8"})],-1)),e("span",Ee,a(l.name),1)]),e("div",Re,[e("span",De,a(l.size_human),1),e("div",Ue,[e("button",{class:"file-action-btn",onClick:O(i=>ne(l),["stop"]),title:"ÂÆûÊó∂"},[...s[19]||(s[19]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polygon",{points:"5,3 19,12 5,21"})],-1)])],8,He),e("button",{class:"file-action-btn",onClick:O(i=>ae(l),["stop"]),title:"‰∏ãËΩΩ"},[...s[20]||(s[20]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e("polyline",{points:"7,10 12,15 17,10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,Oe),v.value==="app"?(o(),n("button",{key:0,class:"file-action-btn danger",onClick:O(i=>ie(l),["stop"]),title:"Âà†Èô§"},[...s[21]||(s[21]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3,6 5,6 21,6"}),e("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,je)):d("",!0)])])],10,$e))),128)),S.value.length===0?(o(),n("div",Ae,"ÊöÇÊó†Êó•ÂøóÊñá‰ª∂")):d("",!0)]))]),e("div",Pe,[e("div",Ke,[c.value?(o(),n("div",Ge,[e("span",We,a(c.value),1),p.value.size_human?(o(),n("span",Je,a(p.value.size_human),1)):d("",!0),p.value.total_lines?(o(),n("span",Qe,a(p.value.total_lines)+" Ë°å",1)):d("",!0)])):(o(),n("span",qe,"ËØ∑ÈÄâÊã©Êó•ÂøóÊñá‰ª∂")),c.value?(o(),n("div",Xe,[e("div",Ye,[s[23]||(s[23]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),w(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>V.value=l),placeholder:"ÊêúÁ¥¢...",onKeyup:he(b,["enter"])},null,544),[[ee,V.value]])]),e("label",Ze,[w(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=l=>D.value=l),onChange:b},null,544),[[se,D.value]]),s[24]||(s[24]=e("span",null,"ÂÄíÂ∫è",-1))]),e("label",es,[w(e("input",{type:"checkbox","onUpdate:modelValue":s[6]||(s[6]=l=>I.value=l)},null,512),[[se,I.value]]),s[25]||(s[25]=e("span",null,"Â±ïÂºÄ",-1))]),e("button",{class:"btn btn-sm btn-secondary",onClick:b,disabled:C.value},"Êü•ËØ¢",8,ss),e("button",{class:"btn btn-sm btn-success",onClick:W,disabled:F.value},[...s[26]||(s[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polygon",{points:"5,3 19,12 5,21"})],-1),$(" ÂÆûÊó∂ ",-1)])],8,ls)])):d("",!0)]),e("div",{class:k(["log-content",{loading:C.value||F.value}])},[c.value?h.value.length===0&&y.value.length===0&&!C.value?(o(),n("div",os,[...s[28]||(s[28]=[e("span",null,"Ê≤°ÊúâÊó•ÂøóÂÜÖÂÆπ",-1)])])):v.value==="app"&&h.value.length>0?(o(),n("div",{key:2,class:"log-entries",ref_key:"logPreRef",ref:m},[(o(!0),n(N,null,H(h.value,(l,i)=>{var g,r,q,X;return o(),n("div",{key:i,class:k(["log-entry",J(l.level),{expanded:P(i)}]),onClick:Y=>ve(i)},[l.is_json?(o(),n(N,{key:0},[e("div",as,[e("span",is,a(de(l.timestamp)),1),e("span",{class:k(["log-level",J(l.level)])},a(l.level),3),l.module?(o(),n("span",us,"["+a(l.module)+"]",1)):d("",!0),e("span",ds,a(l.message),1),re(l)?(o(),n("span",rs,[(g=l.fields)!=null&&g.user_id?(o(),n("span",vs,"üë§"+a(l.fields.user_id),1)):d("",!0),(r=l.fields)!=null&&r.model?(o(),n("span",cs,"ü§ñ"+a(l.fields.model),1)):d("",!0),(q=l.fields)!=null&&q.status?(o(),n("span",{key:2,class:k(["inline-field",ce(l.fields.status)])},a(l.fields.status),3)):d("",!0),((X=l.fields)==null?void 0:X.latency)!==void 0?(o(),n("span",ps,a(pe(l.fields.latency)),1)):d("",!0)])):d("",!0),Q(l)?(o(),n("span",fs,a(P(i)?"‚ñº":"‚ñ∂"),1)):d("",!0)]),P(i)&&Q(l)?(o(),n("div",_s,[e("div",gs,[(o(!0),n(N,null,H(fe(l.fields),(Y,K)=>(o(),n("div",{key:K,class:"log-field"},[e("span",ks,a(K)+":",1),e("span",ys,a(_e(K,Y)),1)]))),128)),l.caller?(o(),n("div",hs,[s[29]||(s[29]=e("span",{class:"field-key"},"caller:",-1)),e("span",ms,a(l.caller),1)])):d("",!0)])])):d("",!0)],64)):(o(),n("span",bs,a(l.raw),1))],10,ns)}),128))],512)):y.value.length>0?(o(),n("pre",{key:3,class:"log-pre",ref_key:"logPreRef",ref:m},a(y.value.join(`
`)),513)):d("",!0):(o(),n("div",ts,[...s[27]||(s[27]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e("polyline",{points:"14,2 14,8 20,8"})],-1),e("span",null,"ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©Êó•ÂøóÊñá‰ª∂",-1)])])),C.value||F.value?(o(),n("div",Cs,[...s[30]||(s[30]=[e("div",{class:"loading-spinner"},null,-1)])])):d("",!0)],2),p.value.total_pages>1?(o(),n("div",xs,[e("div",ws,"ÂÖ± "+a(p.value.total_lines)+" Ë°å",1),e("div",Ss,[w(e("select",{"onUpdate:modelValue":s[7]||(s[7]=l=>A.value=l),onChange:oe,class:"page-size-select"},[...s[31]||(s[31]=[e("option",{value:100},"100 Ë°å",-1),e("option",{value:200},"200 Ë°å",-1),e("option",{value:500},"500 Ë°å",-1)])],544),[[Z,A.value]]),e("div",zs,[e("button",{class:"page-btn",disabled:f.value<=1,onClick:s[8]||(s[8]=l=>{f.value--,b()})},[...s[32]||(s[32]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,Bs),e("span",Ls,a(f.value)+" / "+a(p.value.total_pages),1),e("button",{class:"page-btn",disabled:f.value>=p.value.total_pages,onClick:s[9]||(s[9]=l=>{f.value++,b()})},[...s[33]||(s[33]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,Fs)])])])):d("",!0)])]),(o(),ye(me,{to:"body"},[M.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:s[11]||(s[11]=O(l=>M.value=!1,["self"]))},[e("div",Vs,[s[34]||(s[34]=e("div",{class:"modal-header danger"},[e("div",{class:"danger-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})])]),e("h2",null,"Á°ÆËÆ§Âà†Èô§")],-1)),e("div",Ms,[e("p",Ts,'Á°ÆÂÆöË¶ÅÂà†Èô§Êó•ÂøóÊñá‰ª∂ "'+a(U.value)+'" ÂêóÔºü',1)]),e("div",$s,[e("button",{class:"btn btn-secondary",onClick:s[10]||(s[10]=l=>M.value=!1)},"ÂèñÊ∂à"),e("button",{class:"btn btn-danger",disabled:T.value,onClick:ue},[T.value?(o(),n("span",Es)):d("",!0),$(" "+a(T.value?"Âà†Èô§‰∏≠...":"Âà†Èô§"),1)],8,Ns)])])])):d("",!0)]))]))}},Hs=ge(Rs,[["__scopeId","data-v-ef4d5bfc"]]);export{Hs as default};
