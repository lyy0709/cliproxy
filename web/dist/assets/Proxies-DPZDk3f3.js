import{_ as Y,r as v,a as H,N as Z,o as ss,c as a,b as s,z as I,p,s as w,f as d,v as g,e as c,F as es,x as ts,t as u,L as ls,w as R,I as T,M as q,T as F,l as k,E as i,n}from"./index-CQyKkE5B.js";const os={class:"proxies-page"},ns={class:"page-header"},as={class:"header-actions"},is=["disabled"],rs={class:"filter-bar"},ds={class:"search-box"},us={class:"table-card"},ps={class:"table-container"},vs={class:"data-table"},cs={key:0},fs={class:"proxy-cell"},ms={class:"proxy-info"},gs={class:"proxy-name-row"},bs={class:"proxy-name"},ys={key:0,class:"badge badge-warning"},ks={key:0,class:"proxy-remark"},ws={class:"proxy-address"},xs={class:"col-center"},hs={class:"status-cell"},Cs={key:0,class:"test-badge testing"},_s={key:1,class:"test-badge success"},Vs={key:2,class:"test-badge failed"},$s={key:3,class:"no-test"},Ss={class:"col-center"},Us={class:"toggle-switch"},Bs=["onUpdate:modelValue","onChange"],Ms={class:"action-group"},Ts=["onClick","disabled"],Ps=["onClick","disabled"],zs=["onClick"],Es=["onClick"],Ls={key:0,class:"loading-state"},Hs={key:1,class:"empty-state"},Is={key:0,class:"table-footer"},Rs={class:"pagination-wrap"},qs={class:"pagination-info"},Fs={class:"pagination-controls"},Ns={class:"page-btns"},Os=["disabled"],js={class:"page-current"},Ds=["disabled"],As={class:"modal"},Ks={class:"modal-header"},Gs={class:"modal-body"},Js={class:"form-group"},Qs={class:"import-box"},Ws={class:"form-group"},Xs={class:"form-group"},Ys={class:"type-selector"},Zs={class:"form-row"},se={class:"form-group flex-2"},ee={class:"form-group flex-1"},te={class:"form-row"},le={class:"form-group"},oe={class:"form-group"},ne={class:"form-group"},ae={class:"form-group"},ie={class:"toggle-switch large"},re={class:"modal-footer"},de=["disabled"],ue={key:0,class:"btn-loading"},pe={class:"modal modal-sm"},ve={class:"modal-body"},ce={class:"delete-message"},fe={class:"modal-footer"},me=["disabled"],ge={key:0,class:"btn-loading"},be={__name:"Proxies",setup(ye){const b=v(!1),B=v([]),M=v(""),y=v(!1),x=v(!1),h=v(!1),C=v(""),_=v(!1),V=v(null),$=v(!1),r=H({page:1,pageSize:20,total:0}),P={name:"",type:"http",host:"",port:7890,username:"",password:"",remark:"",enabled:!0},o=H({...P});async function f(){b.value=!0;try{const l=await k.getProxyConfigs({page:r.page,page_size:r.pageSize,keyword:M.value});B.value=(l.items||[]).map(e=>({...e,testStatus:e.test_status||null,latency:e.test_latency||null})),r.total=l.total||0}catch(l){console.error("Failed to load proxies:",l),i.error("加载代理列表失败")}finally{b.value=!1}}let S=null;function N(){clearTimeout(S),S=setTimeout(()=>{r.page=1,f()},300)}Z(()=>{S&&(clearTimeout(S),S=null)});function O(){const l=C.value.trim();if(l)try{const e=/^(https?|socks5):\/\/(?:([^:@]+):([^@]+)@)?([^:\/]+):(\d+)\/?$/i,U=l.match(e);if(U){const[,t,m,X,E,L]=U;o.type=t.toLowerCase(),o.host=E,o.port=parseInt(L,10),o.username=m||"",o.password=X||"",o.name||(o.name=`${t.toUpperCase()} - ${E}:${L}`),i.success("代理地址解析成功")}else{const t=l.match(/^([^:\/]+):(\d+)$/);t&&(o.host=t[1],o.port=parseInt(t[2],10),o.name||(o.name=`HTTP - ${o.host}:${o.port}`),i.success("代理地址解析成功"))}}catch(e){console.error("解析代理URL失败:",e)}}async function z(l){try{return await k.testProxyConnectivity({id:l.id||0,type:l.type,host:l.host,port:l.port,username:l.username||"",password:l.password||""})}catch(e){return{success:!1,error:e.message||"测试请求失败"}}}async function j(l){l.testStatus="testing",l.latency=null;const e=await z(l);e.success?(l.testStatus="success",l.latency=e.latency,i.success(`代理连接成功，延迟: ${e.latency}ms`)):(l.testStatus="failed",i.error(e.error||"代理连接失败"))}function D(){Object.assign(o,{...P}),C.value="",x.value=!1,y.value=!0}function A(l){Object.assign(o,{...l}),C.value="",x.value=!0,y.value=!0}async function K(l){try{await k.toggleProxyConfig(l.id),i.success("更新成功"),!l.enabled&&l.is_default&&(l.is_default=!1)}catch{l.enabled=!l.enabled,i.error("更新失败")}}async function G(l){try{await k.setDefaultProxyConfig(l.id),B.value.forEach(e=>{e.is_default=e.id===l.id}),i.success(`已将 "${l.name}" 设为默认代理`)}catch(e){i.error(e.message||"设置失败")}}function J(l){V.value=l,_.value=!0}async function Q(){if(V.value){$.value=!0;try{await k.deleteProxyConfig(V.value.id),i.success("删除成功"),_.value=!1,V.value=null,f()}catch(l){i.error(l.message||"删除失败")}finally{$.value=!1}}}async function W(){if(!o.name||!o.host||!o.port){i.warning("请填写必填项");return}h.value=!0;try{i.info("正在测试代理连通性...");const l=await z(o);l.success?i.success(`代理连接测试成功，延迟: ${l.latency}ms`):i.warning(`代理连接测试失败: ${l.error}，仍将保存配置`),x.value?(await k.updateProxyConfig(o.id,o),i.success("更新成功")):(await k.createProxyConfig(o),i.success("创建成功")),y.value=!1,f()}catch(l){i.error(l.message||"操作失败")}finally{h.value=!1}}return ss(()=>{f()}),(l,e)=>{var U;return n(),a("div",os,[s("div",ns,[e[23]||(e[23]=s("div",{class:"header-content"},[s("h1",{class:"page-title"},"代理管理"),s("p",{class:"page-subtitle"},"管理代理服务器配置，用于账户连接")],-1)),s("div",as,[s("button",{class:"btn btn-outline",onClick:f,disabled:b.value},[(n(),a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:w({spinning:b.value})},[...e[20]||(e[20]=[s("polyline",{points:"23,4 23,10 17,10"},null,-1),s("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"},null,-1)])],2)),e[21]||(e[21]=p(" 刷新 ",-1))],8,is),s("button",{class:"btn btn-primary",onClick:D},[...e[22]||(e[22]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),p(" 添加代理 ",-1)])])])]),s("div",rs,[s("div",ds,[e[24]||(e[24]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)),d(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>M.value=t),placeholder:"搜索代理名称、地址...",onInput:N},null,544),[[g,M.value]])])]),s("div",us,[s("div",ps,[s("table",vs,[e[35]||(e[35]=s("thead",null,[s("tr",null,[s("th",null,"代理名称"),s("th",null,"类型"),s("th",null,"地址"),s("th",{class:"col-center"},"连接状态"),s("th",{class:"col-center"},"启用"),s("th",null,"操作")])],-1)),b.value?c("",!0):(n(),a("tbody",cs,[(n(!0),a(es,null,ts(B.value,t=>(n(),a("tr",{key:t.id},[s("td",null,[s("div",fs,[s("div",{class:w(["proxy-icon",t.type])},[...e[25]||(e[25]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})],-1)])],2),s("div",ms,[s("div",gs,[s("span",bs,u(t.name),1),t.is_default?(n(),a("span",ys,[...e[26]||(e[26]=[s("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"10",height:"10"},[s("polygon",{points:"12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"})],-1),p(" 默认 ",-1)])])):c("",!0)]),t.remark?(n(),a("span",ks,u(t.remark),1)):c("",!0)])])]),s("td",null,[s("span",{class:w(["type-badge",t.type])},u(t.type.toUpperCase()),3)]),s("td",null,[s("code",ws,u(t.host)+":"+u(t.port),1)]),s("td",xs,[s("div",hs,[t.testStatus==="testing"?(n(),a("span",Cs,[...e[27]||(e[27]=[s("span",{class:"test-spinner"},null,-1),p(" 测试中 ",-1)])])):t.testStatus==="success"?(n(),a("span",_s,[e[28]||(e[28]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"20,6 9,17 4,12"})],-1)),p(" "+u(t.latency)+"ms ",1)])):t.testStatus==="failed"?(n(),a("span",Vs,[...e[29]||(e[29]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),p(" 失败 ",-1)])])):(n(),a("span",$s,"未测试"))])]),s("td",Ss,[s("label",Us,[d(s("input",{type:"checkbox","onUpdate:modelValue":m=>t.enabled=m,onChange:m=>K(t)},null,40,Bs),[[q,t.enabled]]),e[30]||(e[30]=s("span",{class:"toggle-slider"},null,-1))])]),s("td",null,[s("div",Ms,[s("button",{class:"action-btn warning",onClick:m=>G(t),disabled:t.is_default||!t.enabled,title:"设为默认"},[...e[31]||(e[31]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polygon",{points:"12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"})],-1)])],8,Ts),s("button",{class:"action-btn success",onClick:m=>j(t),disabled:t.testStatus==="testing",title:"测试连接"},[...e[32]||(e[32]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),s("polyline",{points:"22,4 12,14.01 9,11.01"})],-1)])],8,Ps),s("button",{class:"action-btn",onClick:m=>A(t),title:"编辑"},[...e[33]||(e[33]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),s("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,zs),s("button",{class:"action-btn danger",onClick:m=>J(t),title:"删除"},[...e[34]||(e[34]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"3,6 5,6 21,6"}),s("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1)])],8,Es)])])]))),128))]))]),b.value?(n(),a("div",Ls,[...e[36]||(e[36]=[s("div",{class:"loading-spinner"},null,-1),s("span",null,"加载中...",-1)])])):c("",!0),!b.value&&B.value.length===0?(n(),a("div",Hs,[...e[37]||(e[37]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[s("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})],-1),s("span",null,"暂无代理配置",-1)])])):c("",!0)]),r.total>0?(n(),a("div",Is,[s("div",Rs,[s("div",qs,"共 "+u(r.total)+" 条",1),s("div",Fs,[d(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.pageSize=t),onChange:f,class:"page-size-select"},[...e[38]||(e[38]=[s("option",{value:10},"10 条/页",-1),s("option",{value:20},"20 条/页",-1),s("option",{value:50},"50 条/页",-1)])],544),[[ls,r.pageSize]]),s("div",Ns,[s("button",{class:"page-btn",disabled:r.page<=1,onClick:e[2]||(e[2]=t=>{r.page--,f()})},[...e[39]||(e[39]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"15,18 9,12 15,6"})],-1)])],8,Os),s("span",js,u(r.page)+" / "+u(Math.ceil(r.total/r.pageSize)||1),1),s("button",{class:"page-btn",disabled:r.page>=Math.ceil(r.total/r.pageSize),onClick:e[3]||(e[3]=t=>{r.page++,f()})},[...e[40]||(e[40]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("polyline",{points:"9,18 15,12 9,6"})],-1)])],8,Ds)])])])])):c("",!0)]),(n(),I(F,{to:"body"},[y.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:e[17]||(e[17]=R(t=>y.value=!1,["self"]))},[s("div",As,[s("div",Ks,[s("h2",null,u(x.value?"编辑代理":"添加代理"),1),s("button",{class:"modal-close",onClick:e[4]||(e[4]=t=>y.value=!1)},[...e[41]||(e[41]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),s("div",Gs,[s("div",Js,[e[43]||(e[43]=s("label",{class:"form-label"},"快速导入",-1)),s("div",Qs,[e[42]||(e[42]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),s("polyline",{points:"17,8 12,3 7,8"}),s("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),d(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),type:"text",class:"form-input",placeholder:"粘贴代理URL，如: http://user:pass@host:port",onInput:O},null,544),[[g,C.value]])]),e[44]||(e[44]=s("p",{class:"form-tip"},"支持格式: http://, https://, socks5:// 开头的代理地址",-1))]),e[57]||(e[57]=s("div",{class:"form-divider"},[s("span",null,"代理配置")],-1)),s("div",Ws,[e[45]||(e[45]=s("label",{class:"form-label"},[p("代理名称 "),s("span",{class:"required"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.name=t),type:"text",class:"form-input",placeholder:"为代理设置一个易识别的名称"},null,512),[[g,o.name]])]),s("div",Xs,[e[49]||(e[49]=s("label",{class:"form-label"},[p("代理类型 "),s("span",{class:"required"},"*")],-1)),s("div",Ys,[s("label",{class:w(["type-option",{active:o.type==="http"}])},[d(s("input",{type:"radio","onUpdate:modelValue":e[7]||(e[7]=t=>o.type=t),value:"http"},null,512),[[T,o.type]]),e[46]||(e[46]=s("span",null,"HTTP",-1))],2),s("label",{class:w(["type-option",{active:o.type==="https"}])},[d(s("input",{type:"radio","onUpdate:modelValue":e[8]||(e[8]=t=>o.type=t),value:"https"},null,512),[[T,o.type]]),e[47]||(e[47]=s("span",null,"HTTPS",-1))],2),s("label",{class:w(["type-option",{active:o.type==="socks5"}])},[d(s("input",{type:"radio","onUpdate:modelValue":e[9]||(e[9]=t=>o.type=t),value:"socks5"},null,512),[[T,o.type]]),e[48]||(e[48]=s("span",null,"SOCKS5",-1))],2)])]),s("div",Zs,[s("div",se,[e[50]||(e[50]=s("label",{class:"form-label"},[p("主机地址 "),s("span",{class:"required"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>o.host=t),type:"text",class:"form-input",placeholder:"例如: 127.0.0.1 或 proxy.example.com"},null,512),[[g,o.host]])]),s("div",ee,[e[51]||(e[51]=s("label",{class:"form-label"},[p("端口 "),s("span",{class:"required"},"*")],-1)),d(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>o.port=t),type:"number",class:"form-input",min:"1",max:"65535"},null,512),[[g,o.port,void 0,{number:!0}]])])]),e[58]||(e[58]=s("div",{class:"form-divider"},[s("span",null,"认证配置（可选）")],-1)),s("div",te,[s("div",le,[e[52]||(e[52]=s("label",{class:"form-label"},"用户名",-1)),d(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>o.username=t),type:"text",class:"form-input",placeholder:"代理认证用户名"},null,512),[[g,o.username]])]),s("div",oe,[e[53]||(e[53]=s("label",{class:"form-label"},"密码",-1)),d(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>o.password=t),type:"password",class:"form-input",placeholder:"代理认证密码"},null,512),[[g,o.password]])])]),s("div",ne,[e[54]||(e[54]=s("label",{class:"form-label"},"备注",-1)),d(s("textarea",{"onUpdate:modelValue":e[14]||(e[14]=t=>o.remark=t),class:"form-textarea",rows:"2",placeholder:"备注信息（可选）"},null,512),[[g,o.remark]])]),s("div",ae,[e[56]||(e[56]=s("label",{class:"form-label"},"启用",-1)),s("label",ie,[d(s("input",{type:"checkbox","onUpdate:modelValue":e[15]||(e[15]=t=>o.enabled=t)},null,512),[[q,o.enabled]]),e[55]||(e[55]=s("span",{class:"toggle-slider"},null,-1))])])]),s("div",re,[s("button",{class:"btn btn-secondary",onClick:e[16]||(e[16]=t=>y.value=!1)},"取消"),s("button",{class:"btn btn-primary",disabled:h.value,onClick:W},[h.value?(n(),a("span",ue)):c("",!0),p(" "+u(h.value?"保存中...":x.value?"保存修改":"添加代理"),1)],8,de)])])])):c("",!0)])),(n(),I(F,{to:"body"},[_.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:e[19]||(e[19]=R(t=>_.value=!1,["self"]))},[s("div",pe,[e[59]||(e[59]=s("div",{class:"modal-header danger"},[s("div",{class:"danger-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),s("line",{x1:"9",y1:"9",x2:"15",y2:"15"})])]),s("h2",null,"确认删除")],-1)),s("div",ve,[s("p",ce,'确定要删除代理 "'+u((U=V.value)==null?void 0:U.name)+'" 吗？',1)]),s("div",fe,[s("button",{class:"btn btn-secondary",onClick:e[18]||(e[18]=t=>_.value=!1)},"取消"),s("button",{class:"btn btn-danger",disabled:$.value,onClick:Q},[$.value?(n(),a("span",ge)):c("",!0),p(" "+u($.value?"删除中...":"删除"),1)],8,me)])])])):c("",!0)]))])}}},we=Y(be,[["__scopeId","data-v-f9473e4a"]]);export{we as default};
