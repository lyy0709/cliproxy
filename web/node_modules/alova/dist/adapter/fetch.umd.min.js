!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).alovaFetch=t()}(this,(function(){"use strict";const e="undefined",t=Promise,o=Object,n=void 0,r=!0,a=!1,s=e=>clearTimeout(e);typeof window===e&&typeof process!==e&&process.browser;const i=e=>{const t=(n=e,o.prototype.toString.call(n));var n;return/^\[object (Blob|FormData|ReadableStream|URLSearchParams)\]$/i.test(t)||((e,t)=>e instanceof t)(e,ArrayBuffer)},c=e=>"string"===(e=>typeof e)(e)||i(e);return function(){return(e,i)=>{const l=i.config,d=l.timeout||0,f=new AbortController,{data:u,headers:p}=e,h=/content-type/i.test(o.keys(p).join()),y=u&&"[object FormData]"===u.toString();h||y||(p["Content-Type"]="application/json; charset=UTF-8");const g=["",n,null,a];o.keys(p).forEach((e=>{var t,o;t=g,o=p[e],t.includes(o)&&delete p[e]}));const b=fetch(e.url,{...l,method:e.type,signal:f.signal,body:c(u)?u:(m=u,JSON.stringify(m,w,v))});var m,w,v;let j,T=a;return d>0&&(j=((e,t=0)=>setTimeout(e,t))((()=>{T=r,f.abort()}),d)),{response:()=>b.then((e=>(s(j),e.clone())),(e=>(e=>t.reject(e))(T?((e,...t)=>new e(...t))(Error,"fetchError: network timeout"):e))),headers:()=>b.then((({headers:e})=>e),(()=>({}))),onDownload:async e=>{let t=a;const o=await b.catch((()=>{t=r}));if(!o)return;const{headers:s,body:i}=o.clone(),c=i?i.getReader():n,l=Number(s.get("Content-Length")||s.get("content-length")||0);if(l<=0)return;let d=0;if(c){const o=()=>c.read().then((({done:n,value:r=new Uint8Array})=>{if(!n&&!t)return d+=r.byteLength,e(d,l),o();t&&e(d,0)}));o()}},onUpload(){console.error("fetch API does'nt support uploading progress. please consider to change `@alova/adapter-xhr` or `@alova/adapter-axios`")},abort:()=>{f.abort(),s(j)}}}}}));
